{
  "id": "4rXRDurF4mQKrHyB",
  "meta": {
    "instanceId": "6d46e25379ef430a7067964d1096b885c773564549240cb3ad4c087f6cf94bd3",
    "templateCredsSetupCompleted": true
  },
  "name": "comentarios automaticos",
  "tags": [],
  "nodes": [
    {
      "id": "5c5322a4-10cf-43a1-8286-101c96d8c356",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        40,
        100
      ],
      "webhookId": "ea7d37ac-9e82-40d7-bbb3-e9b7ce180fc9",
      "parameters": {
        "path": "ea7d37ac-9e82-40d7-bbb3-e9b7ce180fc9",
        "options": {},
        "responseMode": "responseNode"
      },
      "typeVersion": 2
    },
    {
      "id": "c281b25f-4f5a-46a3-b2ca-c9fba1cf98e1",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -980,
        0
      ],
      "parameters": {
        "width": 1440,
        "height": 320,
        "content": "# ì›¹í›… í™•ì¸  \nì„¤ëª…:  \nInstagramì˜ Webhook APIì™€ì˜ ì´ˆê¸° ê²€ì¦ í•¸ë“œì…°ì´í¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.  \nì§€ì‹œì‚¬í•­:  \n\nhub.verify_tokenì´ Instagram App ì„¤ì •ì—ì„œ êµ¬ì„±ëœ í† í°ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.  \n\nì‘ë‹µì€ webhook ì„¤ì •ì„ í™•ì¸í•˜ê¸° ìœ„í•´ hub.challenge ë§¤ê°œë³€ìˆ˜ë¥¼ ì—ì½”í•´ì•¼ í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "f890a4d2-f897-4103-a52f-48fa3555f9a6",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        260,
        100
      ],
      "parameters": {
        "options": {},
        "respondWith": "text",
        "responseBody": "={{ $json.query['hub.challenge'] }}"
      },
      "typeVersion": 1.1
    },
    {
      "id": "4afb4f9b-7f0f-41b8-afd0-d5c134a6a622",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        140,
        1200
      ],
      "parameters": {
        "text": "=### CONTEXTO E PERSONA ###\nVocÃª Ã© um assistente de IA especialista, responsÃ¡vel por gerenciar os comentÃ¡rios de um perfil no Instagram focado em InteligÃªncia Artificial e AutomaÃ§Ãµes. O objetivo do perfil Ã© educar e engajar a comunidade sobre esses temas. Seu tom deve ser amigÃ¡vel, acessÃ­vel, mas tambÃ©m demonstrar conhecimento e profissionalismo. Responda sempre em portuguÃªs brasileiro.\n\n### DADOS DE ENTRADA ###\n- Nome de UsuÃ¡rio: {{ $('data').item.json.usuario.name }}\n- Texto do ComentÃ¡rio:{{ $('data').item.json.usuario.message.text }}\n- Contexto da Publicacao\n\n### TAREFA ###\nAnalise o comentÃ¡rio fornecido e gere uma resposta apropriada, seguindo estas diretrizes:\n\n1.  **AnÃ¡lise e Filtragem:**\n    * **Identifique a IntenÃ§Ã£o:** Ã‰ uma pergunta tÃ©cnica? Uma dÃºvida simples? Um elogio? Uma crÃ­tica construtiva? Um pedido de ajuda? Spam? ConteÃºdo irrelevante?\n    * **RelevÃ¢ncia:** O comentÃ¡rio estÃ¡ relacionado a IA, automaÃ§Ã£o ou ao conteÃºdo do perfil?\n\n2.  **GeraÃ§Ã£o da Resposta:**\n    * **PersonalizaÃ§Ã£o:** Comece a resposta mencionando o nome de usuÃ¡rio (ex: \"OlÃ¡ @{{ $('data').item.json.usuario.name }},\").\n    * **Perguntas Relevantes:** Se for uma pergunta sobre IA/automaÃ§Ã£o que vocÃª pode responder, forneÃ§a uma resposta clara e Ãºtil. Se for muito complexa, agradeÃ§a a pergunta e sugira buscar um post especÃ­fico no perfil, ou diga que o tema Ã© interessante para um futuro conteÃºdo.\n    * **Elogios:** AgradeÃ§a sinceramente o elogio e, se possÃ­vel, conecte-o a um aspecto do perfil ou do conteÃºdo sobre IA/automaÃ§Ã£o.\n    * **CrÃ­ticas Construtivas:** AgradeÃ§a o feedback, mostre que ele foi considerado e responda polidamente.\n    * **Pedidos de Ajuda EspecÃ­ficos (nÃ£o relacionados a conteÃºdo):** Se for um pedido de suporte tÃ©cnico nÃ£o relacionado ao tema central, direcione para o canal adequado ou explique educadamente que nÃ£o pode ajudar com isso ali.\n    * **ComentÃ¡rios Vagos ou de Engajamento Simples (ex: \"Legal!\", \"ğŸ‘\"):** Responda de forma curta e amigÃ¡vel, talvez com um emoji relevante ou incentivando a continuar acompanhando.\n    * **Spam ou Irrelevante:** Se o comentÃ¡rio for claramente spam, promocional nÃ£o solicitado, ofensivo ou totalmente fora do tÃ³pico de IA/automaÃ§Ã£o, NÃƒO gere uma resposta. Neste caso, retorne APENAS a palavra `[IGNORE]`.\n\n3.  **Tom e Estilo:**\n    * Mantenha o tom amigÃ¡vel, Ãºtil e alinhado com um perfil de tecnologia/educaÃ§Ã£o.\n    * Evite respostas genÃ©ricas demais quando uma especÃ­fica for possÃ­vel.\n    * Mantenha as respostas relativamente concisas, adequadas para comentÃ¡rios do Instagram.\n\n### SAÃDA ESPERADA ###\nRetorne APENAS o texto da resposta a ser publicada no Instagram. Se o comentÃ¡rio for classificado como spam/irrelevante conforme a regra 2.7, retorne APENAS a palavra `[IGNORE]`. NÃ£o inclua nenhuma outra explicaÃ§Ã£o ou texto adicional fora da resposta ou da palavra `[IGNORE]`.",
        "options": {},
        "promptType": "define"
      },
      "typeVersion": 1.8
    },
    {
      "id": "e56a220b-f4aa-4505-9157-31980ccb547b",
      "name": "OpenRouter Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "position": [
        60,
        1340
      ],
      "parameters": {
        "model": "google/gemini-2.0-flash-exp:free",
        "options": {}
      },
      "credentials": {
        "openRouterApi": {
          "id": "eGPA8rbskZCfFPBn",
          "name": "OpenRouter account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "9f318cf1-d99f-482d-a6d4-03ec4f603c05",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -980,
        380
      ],
      "parameters": {
        "color": 5,
        "width": 1440,
        "height": 320,
        "content": "# ë°ì´í„° ì¶”ì¶œ  \nì„¤ëª…:  \nìˆ˜ì‹ ëœ ì›¹í›… í˜ì´ë¡œë“œì—ì„œ ê´€ë ¨ ë°ì´í„°ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.  \nì§€ì‹œì‚¬í•­:  \n\nëª¨ë“  í•„ìš”í•œ í•„ë“œ(ì˜ˆ: entry.id, from.id, from.username, message.id, message.text, media.id)ê°€ ì˜¬ë°”ë¥´ê²Œ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.  \n\nì´ ë°ì´í„°ëŠ” í›„ì† ë‹¨ê³„ì—ì„œ ì²˜ë¦¬ ë° ì‘ë‹µì„ ìœ„í•´ ì‚¬ìš©ë  ê²ƒì…ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "a413c839-fa19-44b9-ae33-2638dd45436e",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -980,
        780
      ],
      "parameters": {
        "color": 6,
        "width": 1440,
        "height": 320,
        "content": "# ì‚¬ìš©ì ê²€ì¦  \nì„¤ëª…:  \nëŒ“ê¸€ì´ ê³„ì • ì†Œìœ ìê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œì„œ ì˜¨ ê²ƒì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.  \nì§€ì‹œì‚¬í•­:  \n\nconta.idë¥¼ usuario.idì™€ ë¹„êµí•˜ì„¸ìš”.  \n\nê·¸ë“¤ì´ ë‹¤ë¥¼ ê²½ìš°ì—ë§Œ ì§„í–‰í•˜ì„¸ìš”. ì´ëŠ” ëŒ“ê¸€ì´ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œì„œ ì˜¨ ê²ƒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "b19d4891-5f7e-478b-9458-464af1fd409c",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -980,
        1160
      ],
      "parameters": {
        "color": 2,
        "width": 1440,
        "height": 320,
        "content": "# AI ì‘ë‹µ ìƒì„±  \nì„¤ëª…:  \nAI ì—ì´ì „íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ëŒ“ê¸€ì— ëŒ€í•œ ë§¥ë½ ì¸ì§€ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.  \nì§€ì¹¨:  \n\nAI ëª¨ë¸ì´ ì œëŒ€ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³  í•„ìš”í•œ ì…ë ¥ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ì„¸ìš”.  \n\ní”„ë¡¬í”„íŠ¸ëŠ” AIê°€ ì¹œê·¼í•˜ê³ , ìœ ìµí•˜ë©°, AIì™€ ìë™í™”ì— ì´ˆì ì„ ë§ì¶˜ í”„ë¡œí•„ê³¼ ì¼ì¹˜í•˜ëŠ” ì‘ë‹µì„ ìƒì„±í•˜ë„ë¡ ì•ˆë‚´í•´ì•¼ í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "1f8b05ee-0380-4dc7-8671-f0ae87a7d08f",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -980,
        1560
      ],
      "parameters": {
        "color": 3,
        "width": 1440,
        "height": 320,
        "content": "# ì‘ë‹µ ë³´ë‚´ê¸°  \nì„¤ëª…:  \nAIê°€ ìƒì„±í•œ ë‹µë³€ì„ Instagramì˜ APIë¥¼ í†µí•´ ì‚¬ìš©ìì—ê²Œ ë‹¤ì‹œ ë³´ëƒ…ë‹ˆë‹¤.  \nì§€ì‹œì‚¬í•­:  \n\nHTTP ìš”ì²­ì´ ì ì ˆí•œ ì—”ë“œí¬ì¸íŠ¸ì™€ ì¸ì¦ í—¤ë”ë¡œ ì˜¬ë°”ë¥´ê²Œ í˜•ì‹í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.  \n\nAPI í˜¸ì¶œ ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì ì¬ì ì¸ ì˜¤ë¥˜ë‚˜ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ì„¸ìš”."
      },
      "typeVersion": 1
    },
    {
      "id": "ff54a7c0-40b9-4ad8-a3de-47a8a20cd3e1",
      "name": "Get post data",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -80,
        880
      ],
      "parameters": {
        "url": "=https://graph.instagram.com/v22.0/{{ $json.usuario.media.id }}?fields=id,caption",
        "options": {},
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth"
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "6H4syU3wzaoNBy2k",
          "name": "Header Auth account"
        },
        "facebookGraphApi": {
          "id": "z7CU24qbafckHljY",
          "name": "Facebook Graph account"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "d7a66f78-83f2-4173-8602-c34210364149",
      "name": "get_new_comments",
      "type": "n8n-nodes-base.webhook",
      "position": [
        40,
        480
      ],
      "webhookId": "ea7d37ac-9e82-40d7-bbb3-e9b7ce180fc9",
      "parameters": {
        "path": "ea7d37ac-9e82-40d7-bbb3-e9b7ce180fc9",
        "options": {},
        "httpMethod": "POST"
      },
      "typeVersion": 2
    },
    {
      "id": "0924d70a-45a2-49c9-9459-eb6e7261005e",
      "name": "data",
      "type": "n8n-nodes-base.set",
      "position": [
        280,
        480
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "1a3c5a2e-115d-4072-9d27-9baa47e84d6f",
              "name": "endpoint",
              "type": "string",
              "value": "https://graph.instagram.com/v22.0"
            },
            {
              "id": "ae83344d-abe5-43d6-991f-e757965e4557",
              "name": "conta.id",
              "type": "string",
              "value": "={{ $json.body.entry[0].id }}"
            },
            {
              "id": "d18887fa-b882-4d69-a1c0-d161291fe5fb",
              "name": "usuario.id",
              "type": "string",
              "value": "={{ $json.body.entry[0].changes[0].value.from.id }}"
            },
            {
              "id": "000f2d0e-6fbf-4e58-ae9c-cac4a3c54b33",
              "name": "usuario.name",
              "type": "string",
              "value": "={{ $json.body.entry[0].changes[0].value.from.username }}"
            },
            {
              "id": "d6fa2b24-abbe-48f7-96ff-2fc69f17b61b",
              "name": "usuario.message.id",
              "type": "string",
              "value": "={{ $json.body.entry[0].changes[0].value.id }}"
            },
            {
              "id": "605e9c4c-f2fc-49eb-8639-573c60ef33bb",
              "name": "usuario.message.text",
              "type": "string",
              "value": "={{ $json.body.entry[0].changes[0].value.text }}"
            },
            {
              "id": "198afc5d-3fd1-4d9d-aa5a-8baf75f06d29",
              "name": "usuario.media.id",
              "type": "string",
              "value": "={{ $json.body.entry[0].changes[0].value.media.id }}"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "2836ec33-b19f-4875-bfeb-08d9f9feae49",
      "name": "its me?",
      "type": "n8n-nodes-base.filter",
      "position": [
        200,
        880
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "54c0a2d1-f812-4d6a-b50b-c272cfbba772",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('data').item.json.conta.id }}",
              "rightValue": "={{ $('data').item.json.usuario.id }}"
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "fdf8ff5e-9c17-43f3-a747-79228ca68e03",
      "name": "Post comment",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        260,
        1660
      ],
      "parameters": {
        "url": "={{ $('data').item.json.endpoint }}/{{ $('data').item.json.usuario.message.id }}/replies",
        "method": "POST",
        "options": {},
        "sendBody": true,
        "authentication": "genericCredentialType",
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "={{ $json.output }}"
            }
          ]
        },
        "genericAuthType": "httpHeaderAuth"
      },
      "credentials": {
        "httpHeaderAuth": {
          "id": "6H4syU3wzaoNBy2k",
          "name": "Header Auth account"
        }
      },
      "typeVersion": 4.2
    }
  ],
  "active": true,
  "pinData": {
    "get_new_comments": [
      {
        "json": {
          "body": {
            "entry": [
              {
                "id": "17841458749050638",
                "time": 1745696027,
                "changes": [
                  {
                    "field": "comments",
                    "value": {
                      "id": "17992882022637707",
                      "from": {
                        "id": "1797582914152092",
                        "username": "luchiogutierrez"
                      },
                      "text": "ğŸ˜",
                      "media": {
                        "id": "17969449379894182",
                        "media_product_type": "FEED"
                      }
                    }
                  }
                ]
              }
            ],
            "object": "instagram"
          },
          "query": {},
          "params": {},
          "headers": {
            "host": "host.docker.internal:5678",
            "accept": "*/*",
            "x-scheme": "https",
            "forwarded": "by=_exposr;for=173.252.95.16;host=engaging-seahorse-19.rshare.io;proto=https",
            "x-real-ip": "173.252.95.16",
            "connection": "keep-alive",
            "exposr-via": "77940acbe1755f6fca18880bd02e462ee55d0cde,0374ae5bede6d70d299155239dbb7e045533e1f4",
            "user-agent": "Webhooks/1.0 (https://fb.me/webhooks)",
            "content-type": "application/json",
            "x-request-id": "b0c4e9d6dd2baa18bab7eab283ad4788",
            "content-length": "316",
            "x-forwarded-for": "173.252.95.16",
            "x-hub-signature": "sha1=b3d396ac784244a020268dd9599e708b21688b75",
            "x-forwarded-host": "engaging-seahorse-19.rshare.io",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-scheme": "https",
            "x-hub-signature-256": "sha256=40e1e91b67c7fa82afca10c81ff4b1200d9561384ee5ba690bf9bc22814cb09b"
          },
          "webhookUrl": "https://engaging-seahorse-19.rshare.io/webhook/ea7d37ac-9e82-40d7-bbb3-e9b7ce180fc9",
          "executionMode": "production"
        }
      }
    ],
    "Respond to Webhook": [
      {
        "json": {
          "body": {},
          "query": {
            "hub.mode": "subscribe",
            "hub.challenge": "219585499",
            "hub.verify_token": "teste"
          },
          "params": {},
          "headers": {
            "host": "host.docker.internal:5678",
            "accept": "*/*",
            "x-scheme": "https",
            "forwarded": "by=_exposr;for=173.252.107.25;host=actual-beagle-88.rshare.io;proto=https",
            "x-real-ip": "173.252.107.25",
            "connection": "keep-alive",
            "exposr-via": "b37bd560bd173ee1195fceaef48a1468e8fa83f0,f06a3ed204e476a5915fc6fff7228b77c1c9e1d3",
            "user-agent": "facebookplatform/1.0 (+http://developers.facebook.com)",
            "x-request-id": "037b358cf28db9e3bffdf52703fd9069",
            "accept-encoding": "deflate, gzip",
            "x-forwarded-for": "173.252.107.25",
            "x-forwarded-host": "actual-beagle-88.rshare.io",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-scheme": "https"
          },
          "webhookUrl": "http://localhost:5678/webhook-test/ea7d37ac-9e82-40d7-bbb3-e9b7ce180fc9",
          "executionMode": "test"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2a39918c-36c8-486e-acb3-3420a4a8b8b1",
  "connections": {
    "data": {
      "main": [
        [
          {
            "node": "Get post data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "its me?": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Post comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get post data": {
      "main": [
        [
          {
            "node": "its me?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_new_comments": {
      "main": [
        [
          {
            "node": "data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  }
}