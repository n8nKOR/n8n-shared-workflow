{
  "id": "PoiRk5w0xd1ysq4U",
  "meta": {
    "instanceId": "b9faf72fe0d7c3be94b3ebff0778790b50b135c336412d28fd4fca2cbbf8d1f5",
    "templateCredsSetupCompleted": true
  },
  "name": "AI Agent to chat with you Search Console Data, using OpenAI and Postgres",
  "tags": [],
  "nodes": [
    {
      "id": "9ee6710b-19b7-4bfd-ac2d-0fe1e2561f1d",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "position": [
        1796,
        220
      ],
      "parameters": {
        "tableName": "insights_chat_histories"
      },
      "credentials": {
        "postgres": {
          "id": "",
          "name": "Postgres"
        }
      },
      "typeVersion": 1.1
    },
    {
      "id": "eb9f07e9-ded1-485c-9bf3-cf223458384a",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        1356,
        240
      ],
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "maxTokens": 16000
        }
      },
      "credentials": {
        "openAiApi": {
          "id": "",
          "name": "OpenAi"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "1d3d6fb7-a171-4590-be42-df7eb0c208ed",
      "name": "Set fields",
      "type": "n8n-nodes-base.set",
      "position": [
        940,
        -20
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "9f47b322-e42f-42d7-93eb-a57d22adb849",
              "name": "chatInput",
              "type": "string",
              "value": "={{ $json.body?.chatInput || $json.chatInput }}"
            },
            {
              "id": "73ec4dd0-e986-4f60-9dca-6aad2f86bdeb",
              "name": "sessionId",
              "type": "string",
              "value": "={{ $json.body?.sessionId || $json.sessionId }}"
            },
            {
              "id": "4b688c46-b60f-4f0a-83d8-e283f2d7055c",
              "name": "date_message",
              "type": "string",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "92dc5e8b-5140-49be-8713-5749b7e2d46b",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        407.32142857142867,
        -320
      ],
      "parameters": {
        "color": 7,
        "width": 347.9910714285712,
        "height": 516.8973214285712,
        "content": "## ì›¹í›… - ChatInput\n\nì´ ì›¹í›…ì€ `ChatInput` ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•œ ì—”ë“œí¬ì¸íŠ¸ ì—­í• ì„ í•©ë‹ˆë‹¤. ë‹¤ìŒì„ í¬í•¨í•˜ì„¸ìš”:\n- `chatInput` â€“ ë³´ë‚´ê³  ì‹¶ì€ ë‚´ìš© (ğŸ˜‰)\n- `sessionId` â€“ ì„¸ì…˜ì˜ ê³ ìœ  ì‹ë³„ì\n\në§Œì•½ **Open WebUI**ì™€ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´, `sessionId`ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "ca9f3732-9b62-4f44-b970-77d5d470ec76",
      "name": "Webhook - ChatInput",
      "type": "n8n-nodes-base.webhook",
      "position": [
        500,
        -20
      ],
      "webhookId": "a6820b65-76cf-402b-a934-0f836dee6ba0",
      "parameters": {
        "path": "a6820b65-76cf-402b-a934-0f836dee6ba0/chat",
        "options": {},
        "httpMethod": "POST",
        "responseMode": "responseNode",
        "authentication": "basicAuth"
      },
      "credentials": {
        "httpBasicAuth": {
          "id": "",
          "name": "basic-auth"
        }
      },
      "typeVersion": 2
    },
    {
      "id": "9d684873-6dfe-4709-928d-293b187dfb30",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        820,
        -320
      ],
      "parameters": {
        "color": 7,
        "width": 347.9910714285712,
        "height": 516.8973214285712,
        "content": "## í•„ë“œ ì„¤ì •\n\nì´ ë…¸ë“œëŠ” ì„¸ ê°œì˜ í•„ë“œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:\n- `chatInput`: ì´ì „ ì›¹í›… ë…¸ë“œì—ì„œ ê°€ì ¸ì˜´\n- `sessionId`: ì´ì „ ì›¹í›… ë…¸ë“œì—ì„œ ê°€ì ¸ì˜´\n- `date_message`: ì´ ë…¸ë“œ ë‚´ì—ì„œ í˜•ì‹í™”ë¨. ì´ëŠ” ë‚˜ì¤‘ì— AI ì—ì´ì „íŠ¸ê°€ Search Console ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ ë‚ ì§œ ë²”ìœ„ë¥¼ ê²°ì •í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "8750215a-1e33-4ac8-a6da-95efa8ffed65",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        2600,
        -20
      ],
      "parameters": {
        "options": {}
      },
      "typeVersion": 1.1
    },
    {
      "id": "1b879496-5c0f-4bd5-b4cb-18df2662aef2",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1240,
        -320
      ],
      "parameters": {
        "color": 7,
        "width": 1154.2857142857138,
        "height": 516.8973214285712,
        "content": "## AI ì—ì´ì „íŠ¸ - ë„êµ¬ ì—ì´ì „íŠ¸\n\nì´ AI ì—ì´ì „íŠ¸ëŠ” ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì´ ì§€ì‹œí•©ë‹ˆë‹¤:\n- ì²« ë²ˆì§¸ ì‚¬ìš©ì ë©”ì‹œì§€ì— ëŒ€í•´, **ì‚¬ìš© ê°€ëŠ¥í•œ Search Console ì†ì„±ì„ ê²€ìƒ‰**í•˜ê³  ì‚¬ìš©ìì—ê²Œ **ì´ ì†ì„±ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ì˜µì…˜**ì„ ì œì•ˆí•©ë‹ˆë‹¤\n- ì‚¬ìš©ìì˜ ìì—°ì–´ ì…ë ¥ì— ê¸°ë°˜í•˜ì—¬, ì„ íƒëœ Search Console ì†ì„±ì— ëŒ€í•´ **API í˜¸ì¶œì„ êµ¬ì„±**í•˜ê³  ìš”ì²­ëœ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤\n- ë°ì´í„°ë¥¼ **ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ í…Œì´ë¸”**ë¡œ ì œì‹œí•©ë‹ˆë‹¤\n\nì´ AI ì—ì´ì „íŠ¸ëŠ” ì¹œê·¼í•œ í†¤ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ëª¨ë“  API ìš”ì²­ì„ ì‹¤í–‰í•˜ê¸° ì „ì— **ì‚¬ìš©ìì˜ ë°ì´í„° ìš”êµ¬ ì‚¬í•­ì„ ì •í™•í•˜ê²Œ í™•ì¸**í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "c44c6402-9ddd-4a7b-bc5a-b6c3679a3f68",
      "name": "Call Search Console Tool",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "position": [
        2196,
        220
      ],
      "parameters": {
        "name": "SearchConsoleRequestTool",
        "workflowId": {
          "__rl": true,
          "mode": "list",
          "value": "PoiRk5w0xd1ysq4U",
          "cachedResultName": "My workflow 10"
        },
        "description": "Call this tool when you need to get the website_list or custom_insights",
        "jsonSchemaExample": ""
      },
      "typeVersion": 1.2
    },
    {
      "id": "b1701a89-c5b3-47fb-99d5-4896a6d5c7a2",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1234,
        220
      ],
      "parameters": {
        "color": 6,
        "width": 328.9664285714292,
        "height": 468.13107142857154,
        "content": "### AI ì—ì´ì „íŠ¸ ì„œë¸Œ-ë…¸ë“œ - OpenAI ì±„íŒ… ëª¨ë¸\n\nì´ ì„œë¸Œ-ë…¸ë“œëŠ” ì„ íƒëœ **OpenAI ì±„íŒ… ëª¨ë¸**ì„ í™œìš©í•©ë‹ˆë‹¤. ë„êµ¬ í˜¸ì¶œì„ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ LLMìœ¼ë¡œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n### âš ï¸ ëª¨ë¸ ì„ íƒ\nì´ í…œí”Œë¦¿ì—ì„œ **ê¸°ë³¸ ëª¨ë¸ì€ `gpt-4o`**ì´ë©°, **ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì˜µì…˜**ì…ë‹ˆë‹¤. ë” **ì €ë ´í•œ ëŒ€ì•ˆì„ ì›í•˜ì‹œë©´** `gpt4-o-mini`ë¥¼ ì„ íƒí•˜ì„¸ìš”. ë‹¤ë§Œ, ì‘ë‹µì´ `gpt-4o`ì— ë¹„í•´ ê°€ë” ì•½ê°„ ë‚®ì€ í’ˆì§ˆì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n### ì¶œë ¥"
      },
      "typeVersion": 1
    },
    {
      "id": "cd1a7cec-5845-47b1-a2c8-d3b458a02eb0",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1656,
        220
      ],
      "parameters": {
        "color": 6,
        "width": 328.9664285714292,
        "height": 468.13107142857154,
        "content": "### AI ì—ì´ì „íŠ¸ ì„œë¸Œë…¸ë“œ - Postgres ì±„íŒ… ë©”ëª¨ë¦¬\n\nê·€í•˜ì˜ **Postgres ìê²©ì¦ëª…**ì„ ì—°ê²°í•˜ê³  **í…Œì´ë¸” ì´ë¦„**ì„ ì§€ì •í•˜ì—¬ ì±„íŒ… ê¸°ë¡ì„ ì €ì¥í•˜ì„¸ìš”. ì´ í…œí”Œë¦¿ì—ì„œ ê¸°ë³¸ í…Œì´ë¸” ì´ë¦„ì€ `insights_chat_histories`ì´ë©°, **ì»¨í…ìŠ¤íŠ¸ ì°½ ê¸¸ì´**ëŠ” 5ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n\n**ğŸ‘‹ íŒ:** Postgres ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—†ìœ¼ë©´ [Supabase](https://supabase.com/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ **í•˜ë‚˜ë¥¼ ì„¤ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "290a07d1-c7ed-434d-9851-2a2dcdd35bdf",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2076,
        220
      ],
      "parameters": {
        "color": 6,
        "width": 328.9664285714292,
        "height": 468.13107142857154,
        "content": "AI ì—ì´ì „íŠ¸ í•˜ìœ„ ë…¸ë“œ - ê²€ìƒ‰ ì½˜ì†” ë„êµ¬ í˜¸ì¶œ\n\nì´ **ë„êµ¬ëŠ” AI ì—ì´ì „íŠ¸ì— ì˜í•´ ì‚¬ìš©ë˜ë©°**:\n- ê²€ìƒ‰ ì½˜ì†”ì—ì„œ **ì ‘ê·¼ ê°€ëŠ¥í•œ ì†ì„± ëª©ë¡ì„ ê²€ìƒ‰**\n- **ê²€ìƒ‰ ì½˜ì†” ë°ì´í„°ë¥¼** ì‚¬ìš©ìì˜ ìì—°ì–´ ìš”ì²­ì— ê¸°ë°˜í•˜ì—¬ ê°€ì ¸ì˜¤ê¸°"
      },
      "typeVersion": 1
    },
    {
      "id": "07805c90-7ba5-44d0-b6eb-5a65efb0f8be",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2480,
        -320
      ],
      "parameters": {
        "color": 7,
        "width": 347.9910714285712,
        "height": 516.8973214285712,
        "content": "## ì›¹í›…ì— ì‘ë‹µ\n\nì´ ë…¸ë“œëŠ” ì‚¬ìš©ìì—ê²Œ ì‘ë‹µì„ ë³´ë‚´ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.\n\n**ğŸ‘‹ íŒ:** `intermediateSteps`ê°€ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, Search Consoleì—ì„œ ê°€ì ¸ì˜¨ ì›ì‹œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì°¨íŠ¸ ë˜ëŠ” ë‹¤ë¥¸ ì‹œê°í™”ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤, ë§Œì•½ ì›í•œë‹¤ë©´."
      },
      "typeVersion": 1
    },
    {
      "id": "9a927a40-45e4-4fd5-ab3e-b77578469f82",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        800
      ],
      "parameters": {
        "color": 7,
        "width": 370.3910714285712,
        "height": 492.3973214285712,
        "content": "## íˆ´ í˜¸ì¶œ íŠ¸ë¦¬ê±°\n\nì´ **ë…¸ë“œê°€ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤ AI ì—ì´ì „íŠ¸ê°€ `website_list`ë¥¼ ê²€ìƒ‰í•´ì•¼ í•  ë•Œ** (ì ‘ê·¼ ê°€ëŠ¥í•œ Search Console ì†ì„±) ë˜ëŠ” **`custom_insights`**ë¥¼ ì‚¬ìš©ì ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ ê²€ìƒ‰í•´ì•¼ í•  ë•Œ."
      },
      "typeVersion": 1
    },
    {
      "id": "c54a4653-0f09-46b0-bd20-68919b96e154",
      "name": "Tool calling",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        500,
        1080
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "cc7303ee-1afa-4859-83e7-3af0e963a0f1",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "position": [
        1300,
        1080
      ],
      "parameters": {
        "rules": {
          "values": [
            {
              "outputKey": "custom_insights",
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "a30fe6a6-7d0a-4f14-8492-ae021ddc8ec6",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "leftValue": "={{ $json.request_type }}",
                    "rightValue": "custom_insights"
                  }
                ]
              },
              "renameOutput": true
            },
            {
              "outputKey": "website_list",
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "1b7d6039-6474-4a73-b157-584743a9d7f0",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "leftValue": "={{$json.request_type}}",
                    "rightValue": "website_list"
                  }
                ]
              },
              "renameOutput": true
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 3.2
    },
    {
      "id": "6860ff98-4050-4f64-b8c1-a153e3388df0",
      "name": "Set fields - Consruct API CALL",
      "type": "n8n-nodes-base.set",
      "position": [
        920,
        1080
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "06373437-8288-4171-9f98-e8a417220dd4",
              "name": "request_type",
              "type": "string",
              "value": "={{ $json.query.parseJson().request_type }}"
            },
            {
              "id": "da45c0c5-05f6-4107-81aa-8c08c972d9bf",
              "name": "start_date",
              "type": "string",
              "value": "={{ $json.query.parseJson().startDate }}"
            },
            {
              "id": "59d55034-c612-43d7-9700-4cacdb630ec2",
              "name": "end_date",
              "type": "string",
              "value": "={{ $json.query.parseJson().endDate }}"
            },
            {
              "id": "4c2478c0-7f96-4d3d-a632-089307dc989e",
              "name": "dimensions",
              "type": "string",
              "value": "={{ $json.query.parseJson().dimensions }}"
            },
            {
              "id": "eceefbf9-44e5-4617-96ea-58aca2a29618",
              "name": "rowLimit",
              "type": "number",
              "value": "={{ $json.query.parseJson().rowLimit }}"
            },
            {
              "id": "4e18386e-8548-4385-b620-43efbb11cd63",
              "name": "startRow",
              "type": "number",
              "value": "={{ $json.query.parseJson().startRow}}"
            },
            {
              "id": "a9323a7b-08b4-4015-b3d7-632bcdf56f4e",
              "name": "property",
              "type": "string",
              "value": "={{ encodeURIComponent($json.query.parseJson().property) }}"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "0a2dfb28-17ee-477f-b9ea-f1d8e05e3745",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        820,
        800
      ],
      "parameters": {
        "color": 7,
        "width": 370.3910714285712,
        "height": 492.3973214285712,
        "content": "## í•„ë“œ ì„¤ì • - API í˜¸ì¶œ êµ¬ì„±\n\nì´ ë…¸ë“œëŠ” AI ì—ì´ì „íŠ¸ê°€ ë³´ë‚¸ JSONì— ê¸°ë°˜í•˜ì—¬ í•„ë“œë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤:\n- `request_type` í•„ë“œëŠ” ê²½ë¡œë¥¼ ê²°ì •í•©ë‹ˆë‹¤: `website_list` (ì›¹ì‚¬ì´íŠ¸ ëª©ë¡ì„ ê²€ìƒ‰í•˜ê¸° ìœ„í•´) ë˜ëŠ” `custom_insights` (Search Consoleì—ì„œ ì¸ì‚¬ì´íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´)\n- ì¶”ê°€ í•„ë“œëŠ” API í˜¸ì¶œì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ ì„¤ì •ë˜ë©°, **[ê²€ìƒ‰ ì½˜ì†” API ë¬¸ì„œ](https://developers.google.com/webmaster-tools/v1/searchanalytics/query?hl=en)**ë¥¼ ë”°ë¦…ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "e6ef5c28-01e4-4a0b-9081-b62ec28be635",
      "name": "Set fields - Create searchConsoleDataArray",
      "type": "n8n-nodes-base.set",
      "position": [
        2180,
        980
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "2cffd36f-72bd-4535-8427-a88028ea0c4c",
              "name": "searchConsoleData",
              "type": "array",
              "value": "={{ $json.rows }}"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "abc80061-a794-4e1d-a055-bd88ea5c93eb",
      "name": "Set fields - Create searchConsoleDataArray 2",
      "type": "n8n-nodes-base.set",
      "position": [
        2180,
        1340
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "2cffd36f-72bd-4535-8427-a88028ea0c4c",
              "name": "searchConsoleData",
              "type": "array",
              "value": "={{ $json.siteEntry }}"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "24981eea-980e-4e07-9036-d0042c5b2fbe",
      "name": "Search Console - Get Custom Insights",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1620,
        980
      ],
      "parameters": {
        "url": "=https://www.googleapis.com/webmasters/v3/sites/{{ $json.property }}/searchAnalytics/query",
        "method": "POST",
        "options": {},
        "jsonBody": "={\n \"startDate\": \"{{ $json.start_date }}\",\n \"endDate\": \"{{ $json.end_date }}\",\n \"dimensions\": {{ $json.dimensions }},\n \"rowLimit\": {{ $json.rowLimit }},\n \"startRow\": 0,\n \"dataState\":\"all\"\n}",
        "sendBody": true,
        "sendQuery": true,
        "sendHeaders": true,
        "specifyBody": "json",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "credentials": {
        "oAuth2Api": {
          "id": "",
          "name": "search-console"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "645ff407-857d-4629-926b-5cfc52cfa8ba",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1520,
        800
      ],
      "parameters": {
        "color": 7,
        "width": 370.3910714285712,
        "height": 364.3185243941325,
        "content": "## ê²€ìƒ‰ ì½˜ì†” - ë§ì¶¤ í†µì°°ë ¥ ê°€ì ¸ì˜¤ê¸°\n\nì´ ë…¸ë“œê°€ **ê²€ìƒ‰ ì½˜ì†”ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ API í˜¸ì¶œì„ ìˆ˜í–‰í•©ë‹ˆë‹¤**."
      },
      "typeVersion": 1
    },
    {
      "id": "15aa66e2-f288-4c86-8dad-47e22aa9104f",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1520,
        1180
      ],
      "parameters": {
        "color": 7,
        "width": 370.3910714285712,
        "height": 334.24982142857124,
        "content": "## ê²€ìƒ‰ ì½˜ì†” - ì†ì„± ëª©ë¡ ê°€ì ¸ì˜¤ê¸°\n\nì´ ë…¸ë“œ **Search Consoleì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì†ì„± ëª©ë¡ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ API í˜¸ì¶œì„ ìˆ˜í–‰í•©ë‹ˆë‹¤**."
      },
      "typeVersion": 1
    },
    {
      "id": "cd804a52-833a-451a-8e0c-f640210ee2c4",
      "name": "## Search Console - Get List of Properties",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1620,
        1340
      ],
      "parameters": {
        "url": "=https://www.googleapis.com/webmasters/v3/sites",
        "options": {},
        "sendHeaders": true,
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "credentials": {
        "oAuth2Api": {
          "id": "",
          "name": "search-console"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "3eac4df1-00ac-4262-b520-3a7e218c7e57",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2040,
        800
      ],
      "parameters": {
        "color": 7,
        "width": 370.3910714285712,
        "height": 725.1298214285712,
        "content": "## í•„ë“œ ì„¤ì • - ìƒì„± `searchConsoleDataArray`\n\nì´ ë…¸ë“œë“¤ì€ Search Console APIì˜ ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ë°°ì—´ì„ ìƒì„±í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "86db5800-a735-4749-a800-63d78908610b",
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2520,
        800
      ],
      "parameters": {
        "color": 7,
        "width": 370.3910714285712,
        "height": 722.6464176100125,
        "content": "## ë°°ì—´ ì§‘ê³„ - AI ì—ì´ì „íŠ¸ì— ëŒ€í•œ ì‘ë‹µ\n\nì´ ë…¸ë“œë“¤ì€ ì´ì „ ë‹¨ê³„ì˜ ë°°ì—´ì„ **ì§‘ê³„**í•˜ê³ , outputì´ë¼ëŠ” í•„ë“œë¥¼ í†µí•´ AI ì—ì´ì „íŠ¸ì—ê²Œ `response`ë¡œ ë‹¤ì‹œ ë³´ë‚¸ë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "aefbacc7-8dfc-4655-bc4d-f0498c823711",
      "name": "Array aggregation - response to AI Agent",
      "type": "n8n-nodes-base.aggregate",
      "position": [
        2640,
        980
      ],
      "parameters": {
        "options": {},
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "response"
      },
      "typeVersion": 1
    },
    {
      "id": "e5334c72-981c-4375-ae8e-9a3a0457880b",
      "name": "Array aggregation - response to AI Agent1",
      "type": "n8n-nodes-base.aggregate",
      "position": [
        2660,
        1340
      ],
      "parameters": {
        "options": {},
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "response"
      },
      "typeVersion": 1
    },
    {
      "id": "2e93a798-6c26-4d34-a553-ba01b64ca3fe",
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -398.45627799387194,
        -320
      ],
      "parameters": {
        "width": 735.5589746610085,
        "height": 1615.4504601771982,
        "content": "# AI ì—ì´ì „íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·€í•˜ì˜ Search Console ë°ì´í„°ë¥¼ ì±„íŒ…ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ì„¸ìš”\n\nì´ **AI ì—ì´ì „íŠ¸ëŠ” ê·€í•˜ê°€ Search Console ë°ì´í„°ë¥¼** **ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤**. ê° ë…¸ë“œëŠ” **í…œí”Œë¦¿ ë‚´ì— ë¬¸ì„œí™”ë˜ì–´ ìˆìœ¼ë©°**, ì„¤ì • ë° ì‚¬ìš©ì— ëŒ€í•œ ì¶©ë¶„í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë˜í•œ **Search Console OAuth ìê²© ì¦ëª…ì„ êµ¬ì„±**í•´ì•¼ í•©ë‹ˆë‹¤.\n\nì´ **[n8n ë¬¸ì„œ](https://docs.n8n.io/integrations/builtin/credentials/google/oauth-generic/#configure-your-oauth-consent-screen)**ë¥¼ ë”°ë¼ OAuth ìê²© ì¦ëª…ì„ ì„¤ì •í•˜ì„¸ìš”.\n\n## ì¤‘ìš”í•œ ë©”ëª¨\n\n### Search Console API í˜¸ì¶œì„ ìœ„í•œ ìŠ¤ì½”í”„ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±í•˜ê¸°\n- Google Search Console API OAuth2 ìê²© ì¦ëª…ì—ì„œ **ìŠ¤ì½”í”„ë¥¼ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±**í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤. ì˜ëª»ëœ **êµ¬ì„±ì€ ë¦¬í”„ë ˆì‹œ í† í°ì— ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìœ¼ë©°**, ìì£¼ ì¬ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì œê°€ **ìƒì‹œ ì¬ì¸ì¦ì„ í”¼í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” êµ¬ì„±**ì…ë‹ˆë‹¤:\n![Search Console API oAuth2 config 1](https://i.imgur.com/vVLM7gG.png)\n![Search Console API oAuth2 config 2](https://i.imgur.com/naT1NaX.png)\n\në¬¼ë¡ , ê·€í•˜ì˜ **Search Console ë°ì´í„°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ìƒì„±í•œ Google Cloud Platform ì•±**ì—ì„œ **client_id** ë° **client_secret**ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.\n\n### ì›¹í›…ì— ëŒ€í•œ ì¸ì¦ êµ¬ì„±\n\n**ì›¹í›…ì´ ê³µìš©ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—**, **ì¸ì¦ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”**. ì €ëŠ” **Basic Auth**ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ, ê·€í•˜ì˜ ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ì— ê°€ì¥ ì í•©í•œ ë°©ë²•ì„ **ì„ íƒí•˜ì„¸ìš”**.\n\n## ğŸ¤©ğŸ’– ì´ AI ì—ì´ì „íŠ¸ë¡œ í•  ìˆ˜ ìˆëŠ” ë©‹ì§„ ì˜ˆì‹œ\n![ì´ AI ì—ì´ì „íŠ¸ì™€ì˜ ì±„íŒ… ì˜ˆì‹œ](https://i.imgur.com/jbfsYvT.png)"
      },
      "typeVersion": 1
    },
    {
      "id": "fa630aa9-3c60-4b27-9477-aaeb79c7f37d",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1676,
        -20
      ],
      "parameters": {
        "text": "=user_message : {{ $json.chatInput }}\ndate_message : {{ $json.date_message }}",
        "options": {
          "systemMessage": "=Assist users by asking natural, conversational questions to understand their data needs and building a custom JSON API request to retrieve Search Console data. Handle assumptions internally, confirming them with the user in a friendly way. Avoid technical jargon and never imply that the user is directly building an API request.\n\nPre-Step: Retrieve the Website List\nImportant: Initial Action: Before sending your first message to the user, retrieve the list of connected Search Console properties.\n\nTool Call for Website List:\n\nTool name: SearchConsoleRequestTool\nRequest:\n{\n \"request_type\": \"website_list\" // Always include `request_type` in the API call.\n}\nUsage: Use this list to personalize your response in the initial interaction.\nStep-by-Step Guide\nStep 1: Initial Interaction and Introduction\nGreeting:\n\n\"Hi there! Iâ€™m here to help you gain valuable insights from your Search Console data. Whether you're interested in a specific time frame, performance breakdown by pages, queries, or other dimensions, I've got you covered.\n\nI can help you retrieve data for these websites:\n\nhttps://example1.com\nhttps://example2.com\nhttps://example3.com\nWhich of these properties would you like to analyze?\"\nStep 2: Handling User Response for Property Selection\nAction: When the user selects a property, use the property URL exactly as listed (e.g., \"https://example.com\") when constructing the API call.\n\nStep 3: Understanding the User's Needs\nAcknowledgment and Setting Defaults:\n\nIf the user expresses a general need (e.g., \"I want the last 3 months of page performance\"), acknowledge their request and set reasonable defaults.\n\nExample Response:\n\n\"Great! I'll gather the top 300 queries from the last 3 months for https://example.com. If you'd like more details or adjustments, just let me know.\"\n\nFollow-up Questions:\n\nConfirming Dimensions: If the user doesnâ€™t specify dimensions, ask:\n\n\"For this analysis, Iâ€™ll look at page performance. Does that sound good, or would you like to include other details like queries, devices, or other dimensions?\"\n\nNumber of Results: If the user hasnâ€™t specified the number of results, confirm:\n\n\"I can show you the top 100 results. Let me know if you'd like more or fewer!\"\n\nStep 4: Gathering Specific Inputs (If Necessary)\nAction: If the user provides specific needs, capture and confirm them naturally.\n\nExample Response:\n\n\"Perfect, Iâ€™ll pull the data for [specified date range], focusing on [specified dimensions]. Anything else youâ€™d like me to include?\"\n\nImplicit Defaults:\n\nDate Range: Assume \"last 3 months\" if not specified.\nRow Limit: Default to 100, adjustable based on user input.\nStep 5: Confirming Input with the User\nAction: Summarize the request to ensure accuracy.\n\nExample Response:\n\n\"Hereâ€™s what Iâ€™m preparing: data for https://example.com, covering the last 3 months, focusing on the top 100 queries. Let me know if youâ€™d like to adjust anything!\"\n\nStep 6: Constructing the JSON for Custom Insights\nAction: Build the API call based on the conversation.\n\n{\n \"property\": \"<USER_PROVIDED_PROPERTY_URL>\", // Use the exact property URL.\n \"request_type\": \"custom_insights\",\n \"startDate\": \"<ASSUMED_OR_USER_SPECIFIED_START_DATE>\",\n \"endDate\": \"<ASSUMED_OR_USER_SPECIFIED_END_DATE>\",\n \"dimensions\": [\"<IMPLIED_OR_USER_SPECIFIED_DIMENSIONS>\"], // Array of one or more: \"page\", \"query\", \"searchAppearance\", \"device\", \"country\"\n \"rowLimit\": 300 // Default or user-specified limit.\n}\nStep 7: Presenting the Data\nWhen Retrieving Custom Insights:\n\nImportant: Display all retrieved data in an easy-to-read markdown table format.\nStep 8: Error Handling\nAction: Provide clear, user-friendly error messages when necessary.\n\nExample Response:\n\n\"Hmm, there seems to be an issue retrieving the data. Letâ€™s review what we have or try a different approach.\"\n\nAdditional Notes\nProactive Assistance: Offer suggestions based on user interactions, such as adding dimensions or refining details.\nTone: Maintain a friendly and helpful demeanor throughout the conversation.",
          "returnIntermediateSteps": true
        },
        "promptType": "define"
      },
      "typeVersion": 1.6
    }
  ],
  "active": true,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "abda3766-7d18-46fb-83e7-c2343ff26385",
  "connections": {
    "Switch": {
      "main": [
        [
          {
            "node": "Search Console - Get Custom Insights",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "## Search Console - Get List of Properties",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tool calling": {
      "main": [
        [
          {
            "node": "Set fields - Consruct API CALL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Webhook - ChatInput": {
      "main": [
        [
          {
            "node": "Set fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Call Search Console Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Set fields - Consruct API CALL": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Console - Get Custom Insights": {
      "main": [
        [
          {
            "node": "Set fields - Create searchConsoleDataArray",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "## Search Console - Get List of Properties": {
      "main": [
        [
          {
            "node": "Set fields - Create searchConsoleDataArray 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set fields - Create searchConsoleDataArray": {
      "main": [
        [
          {
            "node": "Array aggregation - response to AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set fields - Create searchConsoleDataArray 2": {
      "main": [
        [
          {
            "node": "Array aggregation - response to AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}