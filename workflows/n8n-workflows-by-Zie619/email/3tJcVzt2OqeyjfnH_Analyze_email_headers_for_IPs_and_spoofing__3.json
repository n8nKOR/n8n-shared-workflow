{
  "id": "3tJcVzt2OqeyjfnH",
  "meta": {
    "instanceId": "03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8"
  },
  "name": "Analyze_email_headers_for_IPs_and_spoofing__3",
  "tags": [
    {
      "id": "GCHVocImoXoEVnzP",
      "name": "ğŸ› ï¸ In progress",
      "createdAt": "2023-10-31T02:17:21.618Z",
      "updatedAt": "2023-10-31T02:17:21.618Z"
    },
    {
      "id": "QPJKatvLSxxtrE8U",
      "name": "Secops",
      "createdAt": "2023-10-31T02:15:11.396Z",
      "updatedAt": "2023-10-31T02:15:11.396Z"
    }
  ],
  "nodes": [
    {
      "id": "a2dca82d-f2b4-41f7-942a-2713a5ae012e",
      "name": "Receive Headers",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -320,
        740
      ],
      "webhookId": "1bde44ab-1360-48b3-9b2f-260a82629bfa",
      "parameters": {
        "path": "90e9e395-1d40-4575-b2a0-fbf52c534167",
        "options": {},
        "httpMethod": "POST",
        "responseMode": "responseNode"
      },
      "typeVersion": 1
    },
    {
      "id": "8cb2e9f4-6954-4812-a443-47cc83e7db0a",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2900,
        420
      ],
      "parameters": {
        "width": 528.410729274179,
        "height": 545.969373616973,
        "content": "[\n    {\n        \"IP ë¶„ì„\": [\n            {\n                \"IP\": \"104.245.209.248\",\n                \"ì‚¬ê¸° ì ìˆ˜\": 87,\n                \"ìµœê·¼ ë‚¨ìš©\": true,\n                \"ì¡°ì§\": \"Deft Hosting\",\n                \"Tor\": false,\n                \"ISP\": \"Server Central Network\",\n                \"ìµœê·¼ ìŠ¤íŒ¸ í™œë™\": \"ì§€ë‚œ 24-48ì‹œê°„ ë™ì•ˆ ìŠ¤íŒ¸ì´ ì‹ë³„ë¨\",\n                \"IP ë°œì‹ ì í‰íŒ\": \"ë‚˜ì¨\"\n            },\n            {\n                \"IP\": \"09.06.05.41\",\n                \"ìµœê·¼ ìŠ¤íŒ¸ í™œë™\": \"ì•Œ ìˆ˜ ì—†ìŒ\",\n                \"IP ë°œì‹ ì í‰íŒ\": \"ì•Œ ìˆ˜ ì—†ìŒ\"\n            }\n        ]\n    },\n    {\n        \"SPF\": \"í†µê³¼\",\n        \"DKIM\": \"í†µê³¼\",\n        \"DMARC\": \"í†µê³¼\"\n    }\n]"
      },
      "typeVersion": 1
    },
    {
      "id": "2464403b-5cb9-4090-b923-912bb8af673a",
      "name": "Fraud Score",
      "type": "n8n-nodes-base.code",
      "position": [
        1340,
        560
      ],
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "let recentSpamActivity = \"undefined\";\nlet ipSenderReputation = \"undefined\";\n\ntry {\n  if ($('IP Quality Score')) {\n    const fraudScore = $('IP Quality Score').item.json.fraud_score;\n\n    recentSpamActivity = \"Not associated with recent spam activity\";\n    \n    if( fraudScore >= 85 ) {\n      recentSpamActivity = \"Identified spam in the past 24-48 hours\";\n    } else if( fraudScore >= 75 ) {\n      recentSpamActivity = \"Identified spam in the past month\";\n    }\n\n    if(!fraudScore) recentSpamActivity = \"unknown\";\n    \n    ipSenderReputation = \"unknown\";\n    \n    if( fraudScore >= 85 ) {\n      ipSenderReputation = \"Bad\";\n    } else if( fraudScore >= 75 ) {\n      ipSenderReputation = \"Poor\";  \n    } else if( fraudScore >= 50 ) {\n      ipSenderReputation = \"Suspicious\";  \n    } else if( fraudScore >= 11 ) {\n      ipSenderReputation = \"OK\";  \n    } else if( fraudScore <= 10 ) {\n      ipSenderReputation = \"Good\";  \n    }\n  }\n} catch (error) {\n  return {\n    \"recent_spam_activity\": recentSpamActivity,\n    \"ip_sender_reputation\": ipSenderReputation\n  };\n}\n\nreturn {\n  \"recent_spam_activity\": recentSpamActivity,\n  \"ip_sender_reputation\": ipSenderReputation\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "70e3e88a-001a-40fc-a771-ace7696f54eb",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        2680,
        760
      ],
      "parameters": {
        "options": {
          "responseCode": 200
        },
        "respondWith": "text",
        "responseBody": "={{ $json.result }}"
      },
      "typeVersion": 1
    },
    {
      "id": "4e16523d-a7e1-44d1-840a-3df3a44bd034",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        460,
        -39.5
      ],
      "parameters": {
        "width": 628.6931617686989,
        "height": 834.0576186324413,
        "content": "![ipqualityscore](https://i.imgur.com/CQRV2uV.png)  \n## IP í‰íŒ ë° ì´ë©”ì¼ ë³´ì•ˆ ë¶„ì„  \nì´ ì›Œí¬í”Œë¡œì˜ í•µì‹¬ ë¶€ë¶„ì€ ë°›ì€ í—¤ë”ì—ì„œ IP ì£¼ì†Œë¥¼ ì¶”ì¶œí•˜ì—¬ ì´ë©”ì¼ ë³´ì•ˆì„ ê°•í™”í•˜ëŠ” ë° íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì„¸ë ¨ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ í†µí•´ ì¶”ì¶œëœ IPë¥¼ IP Quality Score APIì™€ ë¹„êµí•˜ì—¬ ì ì¬ì  ìœ„í—˜ì„ í‰ê°€í•˜ê³  ì‚¬ê¸° í™œë™ì„ ë°©ì§€í•©ë‹ˆë‹¤.  \n\n`Extract IPs from \"received\"` ë…¸ë“œëŠ” ì´ë©”ì¼ í—¤ë”ì—ì„œ IP ì£¼ì†Œë¥¼ ë¶„ë¦¬í•˜ì—¬ n8nì˜ ë³µì¡í•œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  êµ¬ë¬¸ ë¶„ì„í•˜ëŠ” ëŠ¥ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. `Split Out IPs` ë…¸ë“œëŠ” ì´ëŸ¬í•œ IPë¥¼ ê°œë³„ì ìœ¼ë¡œ ê²€í† í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„í•˜ë©°, n8nì˜ ë°ì´í„° ì²˜ë¦¬ ìœ ì—°ì„±ì„ ì„¸ë¶€ì ì¸ ìˆ˜ì¤€ì—ì„œ ì…ì¦í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ, `IP Quality Score` ë…¸ë“œëŠ” ì™¸ë¶€ APIë¥¼ ì¡°íšŒí•˜ì—¬ ê° IPë¥¼ í‰ê°€í•˜ì—¬ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°•í™”í•˜ê³  ìì„¸í•œ ìœ„í—˜ í‰ê°€ë¥¼ ì œê³µí•©ë‹ˆë‹¤.  \n\n### ì¸ì¦ - ë¬´ë£Œ í‹°ì–´ ì´ìš© ê°€ëŠ¥ (ì›” 5000 í¬ë ˆë”§)  \n\nIP Quality ScoreëŠ” API í‚¤ë¥¼ ì›¹ì‚¬ì´íŠ¸ URLì˜ ì¼ë¶€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. n8nì´ í˜„ì¬ URLì— ìê²© ì¦ëª…ì„ ë…¸ì¶œí•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, `IP Quality Score` ë…¸ë“œì˜ ê°€ìƒ í‘œí˜„ ìŠ¤ë‹ˆí«ì— API í‚¤ë¥¼ í•˜ë“œì½”ë”©í•´ì•¼ í•©ë‹ˆë‹¤.  \n\nAPI í‚¤ëŠ” [ì—¬ê¸°](https://www.ipqualityscore.com/documentation/proxy-detection-api/overview) ë¬¸ì„œë¥¼ ë°©ë¬¸í•˜ì—¬ ë¡œê·¸ì¸í•œ í›„, ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ Private Keyë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \n\n### ì¶œë ¥"
      },
      "typeVersion": 1
    },
    {
      "id": "2e8ead40-a97a-4c7e-953c-33546b83eaf6",
      "name": "Explode Email Header",
      "type": "n8n-nodes-base.code",
      "position": [
        80,
        740
      ],
      "parameters": {
        "jsCode": "// Takes the Header string and splits it into various items for analysis.\nlet returnArray = [];\n\nfor (const item of $input.all()) {\n  const headerStr = item.json.header;\n  const headerLines = headerStr.split('\\n');\n    const headerObj = {};\n\n    let currentKey = null;\n    let currentValue = '';\n\n    headerLines.forEach((line) => {\n        const match = line.match(/^([\\w-]+):\\s*(.*)/);\n\n        if (match) {\n            if (currentKey) {\n                if (!headerObj[currentKey]) headerObj[currentKey] = [];\n                headerObj[currentKey].push({ [`${currentKey}`]: currentValue });\n            }\n\n            currentKey = match[1].toLowerCase();\n            currentValue = match[2];\n        } else {\n            currentValue += ' ' + line.trim();\n        }\n    });\n\n    if (currentKey) {\n        if (!headerObj[currentKey]) headerObj[currentKey] = [];\n        headerObj[currentKey].push({ [`${currentKey}Item`]: currentValue });\n    }\n  returnArray.push({\"header\":headerObj});\n}\n\nreturn returnArray;"
      },
      "typeVersion": 2
    },
    {
      "id": "1118176d-a315-439d-a3b6-fe4d40c900c6",
      "name": "Split Out IPs",
      "type": "n8n-nodes-base.itemLists",
      "position": [
        740,
        560
      ],
      "parameters": {
        "options": {
          "destinationFieldName": "ip"
        },
        "fieldToSplitOut": "ips"
      },
      "typeVersion": 3
    },
    {
      "id": "ef118900-11a6-418a-b1b3-159933d62cbf",
      "name": "Extract IPs from \"received\"",
      "type": "n8n-nodes-base.code",
      "position": [
        540,
        560
      ],
      "parameters": {
        "jsCode": "let ips = []\n\nfor (const item of $input.all()) {\n  const header = JSON.stringify(item.json.header.received);\n  console.log(header)\n  const ipRegex = /\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b/g;\n  const ipAddresses = header.match(ipRegex) || [];\n  ips.push(...ipAddresses);\n}\n\nreturn [\n  {\n    ips: ips\n  }\n];"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "ffefc1e2-214c-47d7-a7a3-104fefdccda1",
      "name": "IP Quality Score",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        920,
        560
      ],
      "parameters": {
        "url": "=https://ipqualityscore.com/api/json/ip/{{ Replace me with your API key, it can be found inside the api documentation, leave json.ip alone }}/{{ $json.ip }}?strictness=1&allow_public_access_points=true&lighter_penalties=true",
        "options": {}
      },
      "typeVersion": 4.1
    },
    {
      "id": "2f1c5b30-950c-4e0d-81a6-bf4c2c64f968",
      "name": "IP-API",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1140,
        560
      ],
      "parameters": {
        "url": "=http://ip-api.com/json/{{ $('Split Out IPs').item.json.ip }}",
        "method": "POST",
        "options": {}
      },
      "typeVersion": 4.1
    },
    {
      "id": "c9cae845-63e8-475a-bc08-ba0552712394",
      "name": "Collect interesting data",
      "type": "n8n-nodes-base.set",
      "position": [
        1520,
        560
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "IP",
              "value": "={{ $('Split Out IPs').item.json.ip }}"
            },
            {
              "name": "fraud_score",
              "value": "={{ $('IP Quality Score').item.json.fraud_score }}"
            },
            {
              "name": "recent_abuse",
              "value": "={{ $('IP Quality Score').item.json.recent_abuse }}"
            },
            {
              "name": "Organization",
              "value": "={{ $('IP Quality Score').item.json.organization }}"
            },
            {
              "name": "tor",
              "value": "={{ $('IP Quality Score').item.json.tor }}"
            },
            {
              "name": "ISP",
              "value": "={{ $('IP-API').item.json.isp }}"
            },
            {
              "name": "recent_spam_activity",
              "value": "={{ $json.recent_spam_activity }}"
            },
            {
              "name": "ip_sender_reputation",
              "value": "={{ $json.ip_sender_reputation }}"
            }
          ]
        },
        "options": {
          "dotNotation": true
        },
        "keepOnlySet": true
      },
      "typeVersion": 2
    },
    {
      "id": "01b33cc9-b7b3-44e6-b683-b753e6daa2dc",
      "name": "SPF/DKIM/DMARC from \"authentication-results\"",
      "type": "n8n-nodes-base.code",
      "position": [
        520,
        1160
      ],
      "parameters": {
        "jsCode": "let mailAuth = [];\n\nfor (const item of $input.all()) {\n  // SPF\n  let spf = \"unknown\";\n  if( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"spf=pass\") ) {\n    spf = \"pass\";\n  } else if ( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"spf=fail\") ) {\n    spf = \"fail\";    \n  } else if ( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"spf=neutral\") ) {\n    spf = \"neutral\";\n  }\n\n  // DKIM\n  let dkim = \"unknown\";\n  if( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"dkim=pass\") ) {\n    dkim = \"pass\";\n  } else if ( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"dkim=fail\") ) {\n    dkim = \"fail\";    \n  } else if ( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"dkim=temperror\") ) {\n    dkim = \"error\";\n  }\n\n  // DMARC\n  let dmarc = \"unknown\";\n  if( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"dmarc=pass\") ) {\n    dmarc = \"pass\";\n  } else if ( JSON.stringify(item.json.header[\"authentication-results\"]).includes(\"dmarc=fail\") ) {\n    dmarc = \"fail\";    \n  }\n  \n  mailAuth.push({\n    \"spf\": spf,\n    \"dkim\": dkim,\n    \"dmarc\": dmarc\n  });\n}\n\nreturn mailAuth;"
      },
      "typeVersion": 2
    },
    {
      "id": "33923ec2-10db-4799-9b5e-a369cdd74640",
      "name": "SPF from \"received-spf\"",
      "type": "n8n-nodes-base.code",
      "position": [
        500,
        1858
      ],
      "parameters": {
        "jsCode": "let spfArray = [];\n\nfor (const item of $('Authentication Results Present?').all()) {\n    const spfList = item.json.header[\"received-spf\"];\n\n    if (!spfList || spfList.length == 0) {\n        spfArray.push(\"not-found\");\n    } else {\n        for (const spfItem of spfList) {\n            if (spfItem[\"received-spf\"].toLowerCase().includes(\"fail\")) {\n                spfArray.push(\"fail\");\n            } else if (spfItem[\"received-spf\"].toLowerCase().includes(\"pass\")) {\n                spfArray.push(\"pass\");\n            } else {\n                spfArray.push(\"found\");\n            }\n        }\n    }\n}\nreturn [{spf:spfArray.join(\",\")}];\n"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "9cec1f09-3887-46ec-aa25-b03a0ab34190",
      "name": "DKIM from \"dkim-signature\"",
      "type": "n8n-nodes-base.code",
      "position": [
        760,
        1858
      ],
      "parameters": {
        "jsCode": "let dkimArray = [];\n\nfor (const item of $('Authentication Results Present?').all()) {\n    const dkimList = item.json.header[\"dkim-signature\"];\n\n    if (!dkimList || dkimList.length == 0) { dkimArray.push(\"not-found\") } else {\n        dkimArray.push(\"found\");\n        return dkimArray;\n    }\n\n}\nreturn [{dkim:dkimArray.join(\",\")}];\n"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "0f856808-c044-4547-bc81-5e6d1208d9ad",
      "name": "DMARC from \"received-dmarc\"",
      "type": "n8n-nodes-base.code",
      "position": [
        1020,
        1858
      ],
      "parameters": {
        "jsCode": "let dmarcArray = [];\n\nfor (const item of $('Authentication Results Present?').all()) {\n    const dmarcList = item.json.header[\"received-dmarc\"];\n\n    if (!dmarcList || dmarcList.length == 0) {\n        dmarcArray.push(\"not-found\");\n    } else {\n        for (const dmarcItem of dmarcList) {\n            if (dmarcItem[\"received-dmarc\"].toLowerCase().includes(\"fail\")) {\n                dmarcArray.push(\"fail\");\n            } else if (dmarcItem[\"received-dmarc\"].toLowerCase().includes(\"pass\")) {\n                dmarcArray.push(\"pass\");\n            } else {\n                dmarcArray.push(\"found\");\n            }\n        }\n    }\n}\nreturn [{dmarc:dmarcArray.join(\",\")}];"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "0780dc59-8a4c-4355-9cdc-35b2505043a6",
      "name": "DKIM",
      "type": "n8n-nodes-base.switch",
      "position": [
        1260,
        2718
      ],
      "parameters": {
        "rules": {
          "rules": [
            {
              "value2": "spf=pass",
              "operation": "contains"
            },
            {
              "output": 1,
              "value2": "spf=fail",
              "operation": "contains"
            },
            {
              "output": 2,
              "value2": "spf=neutral",
              "operation": "contains"
            }
          ]
        },
        "value1": "={{ $('Authentication Results Present?').item.json.header['authentication-results'] }}",
        "dataType": "string",
        "fallbackOutput": 3
      },
      "typeVersion": 1
    },
    {
      "id": "b0be02f9-ae6c-460e-9e1c-0be8f878f81b",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -359.7001600000003,
        -46.60400000000038
      ],
      "parameters": {
        "width": 811.1951544353835,
        "height": 1042.0833160085729,
        "content": "ì´ n8n ì›Œí¬í”Œë¡œëŠ” ì´ë©”ì¼ í—¤ë”ë¥¼ ë¶„ì„í•˜ì—¬ ë³´ì•ˆ ìœ„í—˜ì„ í‰ê°€í•˜ëŠ” ë° íƒì›”í•©ë‹ˆë‹¤. ì›¹í›…ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•œ í›„, íŠ¹ì • í—¤ë” ë‚´ìš©ì— ê¸°ë°˜í•˜ì—¬ ë‘ ê°€ì§€ ì² ì €í•œ ì¡°ì‚¬ ê²½ë¡œë¡œ ë¶„ê¸°ë©ë‹ˆë‹¤. `received` í—¤ë”ê°€ ìˆëŠ” ì´ë©”ì¼ì˜ ê²½ìš°, IP ì„¸ë¶€ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ê³  IP Quality Score APIë¥¼ í†µí•´ í¬ê´„ì ì¸ ìœ„í—˜ í‰ê°€ë¥¼ ìˆ˜í–‰í•˜ë©°, ì ì¬ì  ì‚¬ê¸° ë˜ëŠ” ë‚¨ìš© ë° IP-APIë¥¼ í†µí•œ ì§€ë¦¬ ìœ„ì¹˜ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.\n\në°˜ëŒ€ë¡œ, `authentication-results` í—¤ë”ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°, SPF, DKIM ë° DMARC ê²€ì¦ì„ ì„¸ë°€í•˜ê²Œ í‰ê°€í•˜ì—¬ ê° ì´ë©”ì¼ì„ ì¸ì¦ ê²€ì‚¬ì— ê¸°ë°˜í•˜ì—¬ ë¶„ë¥˜í•©ë‹ˆë‹¤.\n\në§ˆì§€ë§‰ìœ¼ë¡œ, ì›Œí¬í”Œë¡œëŠ” ë‘ ê²½ë¡œì˜ ë°ì´í„°ë¥¼ í†µí•©í•˜ì—¬ ì¼ê´€ëœ ë¶„ì„ì„ ì œê³µí•˜ë©°, ì´ë¥¼ ì›¹í›…ì„ í†µí•´ ë‹¤ì‹œ ì „ë‹¬í•˜ì—¬ IP í‰íŒ ë° ì´ë©”ì¼ ì¸ì¦ ìƒíƒœì— ëŒ€í•œ ìƒì„¸í•œ ë³´ê³ ì„œë¥¼ ì œê³µí•©ë‹ˆë‹¤.\n\n`ì›Œí¬í”Œë¡œìš°ê°€ ì•„ì§ ì™„ì„±ë˜ì§€ ì•Šì•˜ìœ¼ë‚˜, DKIM ë¶„ì„ ì—†ì´ë„ ì‘ë™í•©ë‹ˆë‹¤.`\n\n## íŠ¸ë¦¬ê±° ë°©ì‹: ì›¹í›…ì„ í†µí•´\nì›Œí¬í”Œë¡œëŠ” ìˆ˜ì‹ ëœ ì›¹í›… ì¿¼ë¦¬ì— ë”°ë¼ ì¦‰ì‹œ íŠ¸ë¦¬ê±°ë˜ê±°ë‚˜, `Execute Workflow` ë…¸ë“œ ë‚´ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° `webhook trigger`ë¥¼ `Execute Workflow Trigger`ë¡œ ëŒ€ì²´í•˜ê³ , `respond to webhook` ë…¸ë“œë¥¼ ë°ì´í„°ë§Œ ìœ ì§€í•˜ëŠ” `Set node`ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ë” í° ì›Œí¬í”Œë¡œì˜ ì¼ë¶€ë¡œì„œ ì´ ë¶€ë¶„ì´ í—¤ë” ë¶„ì„ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆì‹œ ì…ë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\n[\n  {\n    \"headers\": {\n      \"host\": \"internal.users.n8n.cloud\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": \"Delivered-To: g.andreini@gmail.com\\nReceived: by 2002:a05:7412:be08:b0:df:2c3c:4cc with SMTP id la8csp2349351rdb;\\n        Tue, 5 Sep 2023 15:06:08 -0700 (PDT)\\nX-Google-Smtp-Source: AGHT+IEHz2WAE5kssnJSpwJyhbuq3ZjNQTqZfo6OFeCd5w2EKOdnF3nICb1zIL4Y1tahQpr5xY6+\\nX-Received: by 2002:a17:907:78c3:b0:9a1:f2d3:ade9 with SMTP id kv3-20020a17090778c300b009a1f2d3ade9mr802685ejc.42.1693951567785;\\n        Tue, 05 Sep 2023 15:06:07 -0700 (PDT)\\nARC-Seal: i=1; a=rsa-sha256; t=1693951567; cv=none;\\n        d=google.com; s=arc-20160816;\\n        b=zsD04giTt/gbOxX6IW6/ETi7zkiuLYPaM6nYtckkcCfhqz5H7qvNN1NkDrlbnsXEr2\\n         3jVLDlhAZCXVg4qGNEWTjfzLwn5eQoUdW7iy//8XZU3Xy2xtORLBKKWs+Pjzx2sBP9KS\\n         zsy0Tg+rlAqi/aOH8+D+ANC0dCibsPau92zLS6GIvil700hvAJ7KB9fw0s/Ntx4z8VGv\\n         0P+BodOQDO9kdHtuMkgu/waF86Xe0ImcxtvMHQ/mNjbTSRDTa0d04+X7ILVf4q0B5gFg\\n         tnykE51GIS8Ey8ElAd4z/it1E/ffMJ7QAgiDSO0tZRc2NnM0QQ1oYrO9IL0cNuW1P33Q\\n         PfNA==\\nARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;\\n        h=mime-version:date:subject:to:from:reply-to:message-id;\\n        bh=f9tT4LpRqlQSioyOCLufJC57T1y2rwgsPezOJPbokDM=;\\n        fh=syfPZFOxHm03Bg8T666hpPsY3BFS1EZPTr8jKyQ7bFk=;\\n        b=fsZErxdmb95VXJpAyI8Pff38Ifu47WaONvSwpYaSstYbRoKDZSS3SH247NHt/+uyq+\\n         7UUF37XenbcZif1p3iOa96JxcYBtLLp3cI9pe8NRQjJtceXQk70PVcCGNXORiAxoCGT+\\n         iCMzUoFjTAfhK729rSldyFJ+I+WU3k+W/CjL1+geJkU5fEmg+eBEo8hDifqW3Iv73auq\\n         uDnxkLZ55yX9W2ARwv/204qqqxYHKfdXDIWGDyeXE10NHLTr/GAR8DWVx6qD8b4U0Zc3\\n         MC+SZxGsIcSCr5ouXIovuQBYcdmqDgDxAaN9VTfYdnXobblN6bo3OcC0rqiiyVJnV3ZA\\n         BYoQ==\\nARC-Authentication-Results: i=1; mx.google.com;\\n       spf=fail (google.com: domain of eljyzxd@molkase.de does not designate 89.31.72.29 as permitted sender) smtp.mailfrom=eljyzxd@molkase.de\\nReturn-Path: <eljyzxd@molkase.de>\\nReceived: from mail19.interhost.it (mail19.interhost.it. [89.31.72.29])\\n        by mx.google.com with ESMTPS id k15-20020a170906578f00b00992aaed9f81si7955121ejq.356.2023.09.05.15.06.07\\n        for <g.andreini@gmail.com>\\n        (version=TLS1_2 cipher=ECDHE-ECDSA-AES128-GCM-SHA256 bits=128/128);\\n        Tue, 05 Sep 2023 15:06:07 -0700 (PDT)\\nReceived-SPF: fail (google.com: domain of eljyzxd@molkase.de does not designate 89.31.72.29 as permitted sender) client-ip=89.31.72.29;\\nAuthentication-Results: mx.google.com;\\n       spf=fail (google.com: domain of eljyzxd@molkase.de does not designate 89.31.72.29 as permitted sender) smtp.mailfrom=eljyzxd@molkase.de\\nReceived: from mailfront2.interhost.it (mailfront2.interhost.it [89.31.72.21]) (using TLSv1.2 with cipher ADH-AES256-GCM-SHA384 (256/256 bits)) (No client certificate requested) by mail19.interhost.it (Postfix) with ESMTPS id 7BA73561D21 for <info@thepund.it>; Wed,\\n  6 Sep 2023 00:06:06 +0200 (CEST)\\nReceived: from mailfront2.interhost.it (localhost [127.0.0.1]) by mailfront2.interhost.it (Postfix) with ESMTP id 5AEE1835B2 for <info@thepund.it>; Wed,\\n  6 Sep 2023 00:06:06 +0200 (CEST)\\nReceived-SPF: Pass (mailfrom) identity=mailfrom; client-ip=62.173.139.164; helo=mail.molkase.de; envelope-from=eljyzxd@molkase.de; receiver=<UNKNOWN>\\nReceived: from mail.molkase.de (mail.molkase.de [62.173.139.164]) by mailfront2.interhost.it (Postfix) with ESMTP id A8BC3835B5 for <info@thepund.it>; Wed,\\n  6 Sep 2023 00:06:05 +0200 (CEST)\\nReceived: from molkase.de (mail.molkase.de [62.173.139.164]) by mail.molkase.de (Postfix) with ESMTPA id A561D80FB872; Tue,\\n  5 Sep 2023 23:08:50 +0300 (EEST)\\nMessage-ID: <15404342A12424728J51235153O87748181D@ideljyzxd>\\nReply-To: Legal Casino <eljyzxd@molkase.de>\\nFrom: Legal Casino <eljyzxd@molkase.de>\\nTo: <info@tevassociati.it>\\nSubject: Bonus for all European residents\\nDate: Tue, 05 Sep 2023 23:08:55 +0300\\nMIME-Version: 1.0\\nContent-Type: multipart/related; type=\\\"multipart/alternative\\\"; boundary=\\\"----=_NextPart_000_0018_01D9E04D.79971B70\\\"\\nX-Virus-Scanned: ClamAV using ClamSMTP\"\n  }\n]"
      },
      "typeVersion": 1
    },
    {
      "id": "3c8fe0f3-0b65-4366-9c1e-a2a7bcc35ed5",
      "name": "Extract Email Header from webhook",
      "type": "n8n-nodes-base.set",
      "position": [
        -99,
        740
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "header",
              "value": "={{ $json.body }}"
            }
          ]
        },
        "options": {},
        "keepOnlySet": true
      },
      "typeVersion": 2
    },
    {
      "id": "4eef6457-27cf-442f-bccf-75663170401b",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1100,
        20
      ],
      "parameters": {
        "width": 610.1426815377504,
        "height": 772.7590323462559,
        "content": "![ipapi](https://i.imgur.com/OMhn14b.png)  \n## IP í‰íŒ ë° ì‚¬ê¸° ë¶„ì„  \nì´ ì›Œí¬í”Œë¡œ ì„¹ì…˜ì€ ê° IP ì£¼ì†Œì— ëŒ€í•œ ì‹¬ì¸µ í‰íŒ í‰ê°€ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. `IP-API` ë…¸ë“œëŠ” ì§€ë¦¬ì  ìœ„ì¹˜ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ë©°, `Fraud Score` ë…¸ë“œëŠ” IPì™€ ê´€ë ¨ëœ ìœ„í—˜ì„ í‰ê°€í•˜ì—¬ ì ì¬ì ì¸ ìŠ¤íŒ¸ ë˜ëŠ” ë‚¨ìš© í™œë™ì„ í”Œë˜ê·¸í•©ë‹ˆë‹¤.  \n\n### ë°œê²¬ ì‚¬í•­ í†µí•©  \nì‚¬ê¸° ì ìˆ˜ ë° ISP ì •ë³´ì™€ ê°™ì€ ì£¼ìš” ë°ì´í„° í¬ì¸íŠ¸ëŠ” `Collect interesting data` ë…¸ë“œì— ì˜í•´ í•©ì„±ë˜ì–´, ê° IPì— ëŒ€í•œ ëª…í™•í•œ í”„ë¡œí•„ì„ ì œê³µí•˜ì—¬ ì •ë³´ì— ê¸°ë°˜í•œ ì˜ì‚¬ ê²°ì •ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.  \n\n### ì¸ì¦ - ë¬´ë£Œ í‹°ì–´ ì‚¬ìš© ê°€ëŠ¥ (45 ìš”ì²­/ë¶„)  \nì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” IP ì£¼ì†Œë‹¹ 45 ìš”ì²­ per ë¶„ìœ¼ë¡œ ì œí•œë©ë‹ˆë‹¤.  \n\nì œí•œì„ ì´ˆê³¼í•˜ë©´ ìš”ì²­ì´ ìŠ¤ë¡œí‹€ë§ë©ë‹ˆë‹¤ `(HTTP 429)`ê¹Œì§€ ì†ë„ ì œí•œ ì°½ì´ ì¬ì„¤ì •ë  ë•Œê¹Œì§€. ì§€ì†ì ìœ¼ë¡œ ì œí•œì„ ì´ˆê³¼í•˜ë©´ IP ì£¼ì†Œê°€ 1ì‹œê°„ ë™ì•ˆ ì°¨ë‹¨ë©ë‹ˆë‹¤.  \n\nì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤, [ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ë¬¸ì„œë¥¼ ë³´ì‹­ì‹œì˜¤.](https://ip-api.com/docs)  \n\n### ì¶œë ¥"
      },
      "typeVersion": 1
    },
    {
      "id": "764de66e-8e40-44d1-8c09-fb099753d800",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1720,
        141.75
      ],
      "parameters": {
        "width": 1153.9919748350057,
        "height": 818.3738794326835,
        "content": "![n8n](https://i.imgur.com/lKnBNnH.png)  \n## ì´ë©”ì¼ í—¤ë” ë¶„ì„ ë° ì‘ë‹µ  \n`Analyze Email Headers For IPs and Spoofing` ì›Œí¬í”Œë¡œì˜ ê²°ë¡  ë¶€ë¶„ì€ ì´ë©”ì¼ í—¤ë” ì •ë³´ë¥¼ ìˆ˜ì§‘í•œ í›„ ì´ë¥¼ ë¶„ì„í•˜ê³  ì‘ë‹µí•˜ê¸° ìœ„í•´ ì •êµí•œ ë°ì´í„° ì²˜ë¦¬ë¥¼ í†µí•©í•©ë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ì´ë©”ì¼ í—¤ë”ì—ì„œ ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ì¢…í•©í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì¤€ë¹„í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.  \n\n- **ë°ì´í„° ì§‘ê³„ ë° ë³‘í•©:** `Merge1`ê³¼ Item `Lists2` ë…¸ë“œëŠ” ì´ì „ ë‹¨ê³„ì˜ ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ëŠ” ë° í•µì‹¬ì ì…ë‹ˆë‹¤. ì´ ë…¸ë“œë“¤ì€ ë‹¤ì–‘í•œ í•­ëª©ì„ íš¨ê³¼ì ìœ¼ë¡œ ì—°ê²°í•˜ê³  IP ë¶„ì„ ë°ì´í„°ë¥¼ ì»´íŒŒì¼í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ì´ë©”ì¼ í—¤ë”ì˜ í¬ê´„ì ì¸ ë³´ê¸°ë¥¼ ìƒì„±í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë©°, íŠ¹íˆ IPì™€ ì ì¬ì  ìŠ¤í‘¸í•‘ ì§€í‘œì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.  \n\n- **ì¶”ê°€ ë³‘í•© ë° ì‘ë‹µ ì¤€ë¹„:** `Merge3`ì— ì˜í•´ ë˜ ë‹¤ë¥¸ ë³‘í•© ì‘ì—…ì´ ìˆ˜í–‰ë˜ì–´ ìµœì¢… ì¶œë ¥ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤. ê·¸ í›„, Item Lists3ì´ í•­ëª©ì„ ì¶”ê°€ë¡œ ì—°ê²°í•˜ì—¬ í•˜ë‚˜ì˜ ì¼ê´€ëœ ê²°ê³¼ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ëŠ” ëª¨ë“  ê´€ë ¨ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ì»´íŒŒì¼í•˜ì—¬ ìµœì¢… ì‘ë‹µì— ëŒ€ë¹„í•©ë‹ˆë‹¤.  \n\n- **ìµœì¢… ì›¹í›… ì‘ë‹µ:** Respond to Webhook ë…¸ë“œëŠ” ì´ ì›Œí¬í”Œë¡œì˜ ë ì§€ì ì…ë‹ˆë‹¤. ì´ ë…¸ë“œëŠ” ë¶„ì„ëœ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ìº¡ìŠí™”í•˜ì—¬ ì‘ë‹µí•˜ë„ë¡ êµ¬ì„±ë©ë‹ˆë‹¤. ì‘ë‹µì€ 200 HTTP ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ì—¬ ì„±ê³µì ì¸ ì‘ì—…ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ë…¸ë“œëŠ” n8nì˜ ë°ì´í„° ì²˜ë¦¬ ë° ë¶„ì„ ëŠ¥ë ¥ë¿ë§Œ ì•„ë‹ˆë¼ ì§€ì •ëœ ìˆ˜ì‹ ì(ì›¹í›… ë˜ëŠ” ê¸°íƒ€ ì—”ë“œí¬ì¸íŠ¸)ì—ê²Œ ê²°ê³¼ë¥¼ ì›í™œí•˜ê²Œ ì „ë‹¬í•˜ëŠ” ëŠ¥ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.  \n\nì´ ì›Œí¬í”Œë¡œê°€ ëë‚˜ë©´ ì´ë©”ì¼ í—¤ë”ì— ëŒ€í•œ êµ¬ì¡°í™”ëœ ì„¸ë¶€ ë¶„ì„ì„ ì–»ì„ ìˆ˜ ìˆìœ¼ë©°, íŠ¹íˆ IPì™€ ì ì¬ì  ìŠ¤í‘¸í•‘ ìœ„í˜‘ì„ ì‹ë³„í•˜ë„ë¡ ë§ì¶¤í™”ë©ë‹ˆë‹¤. ì´ëŠ” n8nì´ ë°ì´í„° ì²˜ë¦¬ ëŠ¥ë ¥ë¿ë§Œ ì•„ë‹ˆë¼ ì´ë©”ì¼ ë³´ì•ˆì„ ìœ ì§€í•˜ëŠ” ë° ì¤‘ìš”í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ì‚¬ì´ë²„ ë³´ì•ˆ ë„êµ¬ë¡œì„œì˜ íš¨ê³¼ì„±ì„ ê°•ì¡°í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "2fa3c912-f478-48a1-9b2e-5e3f51c6a363",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        460,
        800
      ],
      "parameters": {
        "width": 630.5819800503231,
        "height": 535.80387776221,
        "content": "## ì¸ì¦ ë¶„ì„\n\nì´ ì„¹ì…˜ì€ ì´ë©”ì¼ í—¤ë” ë‚´ì˜ SPF, DKIM ë° DMARC ë ˆì½”ë“œë“¤ì˜ ì¡´ì¬ì™€ ìœ íš¨ì„±ì„ í‰ê°€í•˜ì—¬ ì¸ì¦ì„ í™•ì¸í•©ë‹ˆë‹¤. `SPF/DKIM/DMARC from \"authentication-results\"` ë…¸ë“œëŠ” ì¸ì¦ ê²°ê³¼ë¥¼ í‰ê°€í•˜ì—¬ ì´ë©”ì¼ì´ ë°œì‹ ì ê²€ì¦ì„ ìœ„í•œ ì„¤ì •ëœ ë³´ì•ˆ í‘œì¤€ì„ ì¶©ì¡±í•˜ëŠ”ì§€ ë³´ì¥í•©ë‹ˆë‹¤. \n\nn8n ì½”ë“œ ë…¸ë“œëŠ” `node.js`ë¼ê³  ë¶ˆë¦¬ëŠ” `Javascript` ë²„ì „ì´ë‚˜ `Pyodide`ë¼ê³  ë¶ˆë¦¬ëŠ” `Python` ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ê²½ìš°ì—ëŠ” Javascriptë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "5297e5a0-f2d1-4ee3-b931-9b1abe75b2cc",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        460,
        2038
      ],
      "parameters": {
        "width": 983.9576126829675,
        "height": 1039.0141642262715,
        "content": "![n8n](https://i.imgur.com/yz109RJ.png)  \n## SPF ë° DKIM ì¸ì¦ ë¼ìš°íŒ…  \nì´ ë…¸ë“œ ê·¸ë£¹ì€ ì´ë©”ì¼ í—¤ë”ì—ì„œ ë°œê²¬ëœ SPF ë° DKIM ë ˆì½”ë“œì— ëŒ€í•œ ì¸ì¦ ìƒíƒœ ë¼ìš°íŒ…ì„ ì¡°ì •í•©ë‹ˆë‹¤.  \n\nSPF ìœ íš¨ì„± ê²€ì‚¬ ê²°ì •  \n`SPF` ìŠ¤ìœ„ì¹˜ ë…¸ë“œëŠ” ì´ë©”ì¼ í—¤ë”ì˜ SPF ê²°ê³¼ë¥¼ í‰ê°€í•˜ì—¬ SPFê°€ í†µê³¼, ì‹¤íŒ¨, ë˜ëŠ” ì¤‘ë¦½ì¸ì§€ì— ë”°ë¼ íë¦„ì„ ë‹¤ë¥¸ ê²½ë¡œë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤. `\"Set1,\" \"Set2,\" ë° \"Set4\"` ë…¸ë“œëŠ” ê°ê°ì˜ SPF ì¸ì¦ ìƒíƒœë¥¼ í• ë‹¹í•˜ì—¬, ë³´ì•ˆ ê²€ì¦ì— ë”°ë¼ ì´ë©”ì¼ì„ ì¶”ê°€ ì²˜ë¦¬í•˜ë„ë¡ í‘œì‹œí•©ë‹ˆë‹¤.  \n\nDKIM í‰ê°€ ì²˜ë¦¬  \nDKIMì„ ëª…ì‹œì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šì§€ë§Œ, `\"DKIM\" ìŠ¤ìœ„ì¹˜ ë…¸ë“œ`ëŠ” ì´ë¦„ì´ ì˜ëª» ì§€ì •ëœ ê²ƒìœ¼ë¡œ ë³´ì´ë©°, ì—­í• ì„ ì •í™•íˆ ë°˜ì˜í•˜ë„ë¡ ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” SPF ë…¸ë“œì™€ ìœ ì‚¬í•œ ë¼ìš°íŒ… ë¡œì§ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ DKIM ê²°ê³¼ë¥¼ ì²˜ë¦¬í•´ì•¼ í•¨ì„ ì‹œì‚¬í•©ë‹ˆë‹¤. ë§Œì•½ ì‹¤ì œë¡œ DKIMì„ ìœ„í•œ ê²ƒì´ë¼ë©´, ì¸ì¦ ê²°ê³¼ ë‚´ì—ì„œ `\"dkim=pass/fail/neutral\"`ì„ í™•ì¸í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.  \n\nì•Œ ìˆ˜ ì—†ëŠ” SPF ìƒíƒœ í• ë‹¹  \në§ˆì§€ë§‰ìœ¼ë¡œ, `\"Set5\"` ë…¸ë“œëŠ” SPF ê²°ê³¼ê°€ ë°œê²¬ë˜ì§€ ì•Šê±°ë‚˜ ë¶ˆí™•ì‹¤í•œ ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ì—¬ ìƒíƒœë¥¼ `\"unknown\"`ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "f6c06bc5-048c-433e-9bfa-f155ca6735e4",
      "name": "Received Headers Present?",
      "type": "n8n-nodes-base.if",
      "position": [
        300,
        660
      ],
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.header.received.length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "a92ef09c-0cc6-469c-98ff-8c6172615a4b",
      "name": "Authentication Results Present?",
      "type": "n8n-nodes-base.if",
      "position": [
        300,
        820
      ],
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.header[\"authentication-results\"].length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "aef7f739-dfef-40b1-b01f-29adad4a9bda",
      "name": "Aggregate Authentication Data",
      "type": "n8n-nodes-base.set",
      "position": [
        1280,
        1858
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "spf",
              "value": "={{ $('SPF from \"received-spf\"').all() }}"
            },
            {
              "name": "dkim",
              "value": "={{ $('DKIM from \"dkim-signature\"').all() }}"
            },
            {
              "name": "dmarc",
              "value": "={{ $('DMARC from \"received-dmarc\"').all() }}"
            }
          ]
        },
        "options": {},
        "keepOnlySet": true
      },
      "typeVersion": 2
    },
    {
      "id": "5d7ce661-3bdf-45e5-a1e2-335602e62b5d",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        460,
        1349.3807407407407
      ],
      "parameters": {
        "width": 984.4210239195738,
        "height": 672.6925241611406,
        "content": "![nodejs](https://i.imgur.com/OqjRFGZ.png)  \n## ì´ë©”ì¼ ì¸ì¦ í‰ê°€  \nì´ ë…¸ë“œ ì„¸íŠ¸ëŠ” ì´ë©”ì¼ í—¤ë”ì˜ ì¸ì¦ì„ í‰ê°€í•˜ëŠ” ë° ì „ë…í•˜ë©°, íŠ¹íˆ SPF, DKIM ë° DMARC ìœ íš¨ì„±ì„ ì¤‘ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.  \n\n### SPF, DKIM ë° DMARC ì¶”ì¶œ  \n`SPF from 'received-spf'`ë¡œ ì‹œì‘í•˜ì—¬, ì´ ë…¸ë“œëŠ” ì´ë©”ì¼ì˜ SPF ë ˆì½”ë“œë¥¼ ì¤€ìˆ˜ ì—¬ë¶€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. ê·¸ ë‹¤ìŒ, `DKIM from 'dkim-signature'`ëŠ” DKIM ì„œëª…ì„ ê²€ì‚¬í•˜ì—¬ ì¡´ì¬ì™€ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ, `DMARC from 'received-dmarc'`ëŠ” DMARC ë ˆì½”ë“œë¥¼ ì˜ˆìƒë˜ëŠ” ë³´ì•ˆ ê´€í–‰ê³¼ ì¼ì¹˜ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.  \n\n### ë°ì´í„° ì§‘ê³„  \ní‰ê°€ê°€ ì™„ë£Œë˜ë©´, `Aggregate Authentication Data`ëŠ” ê²°ê³¼ë¥¼ í†µí•©ëœ ë°ì´í„° ì„¸íŠ¸ë¡œ ì»´íŒŒì¼í•˜ì—¬ ê° ì´ë©”ì¼ì˜ ì¸ì¦ ìƒíƒœë¥¼ ëª…í™•íˆ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.  \n\n### ì£¼ìš” ì´ˆì   \nì´ ë…¸ë“œëŠ” ì´ë©”ì¼ì˜ ì§„ìœ„ë¥¼ í™•ì¸í•˜ì—¬ ì ì¬ì ìœ¼ë¡œ ìœ í•´í•œ ì´ë©”ì¼ì„ í•„í„°ë§í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë©°, í”¼ì‹± ë° ìŠ¤í‘¸í•‘ ì‹œë„ì— ëŒ€í•œ ë³´í˜¸ì˜ í•µì‹¬ ë‹¨ê³„ì…ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "88888a82-815b-423a-85d3-8c86756d10cd",
      "name": "IP Data Merge",
      "type": "n8n-nodes-base.merge",
      "position": [
        1800,
        660
      ],
      "parameters": {},
      "typeVersion": 2.1
    },
    {
      "id": "b7add244-9759-450f-8b01-6ec4555a5971",
      "name": "Merge Security Data",
      "type": "n8n-nodes-base.merge",
      "position": [
        2171,
        760
      ],
      "parameters": {},
      "typeVersion": 2.1
    },
    {
      "id": "ef679cda-9420-44fd-90cc-23be1b166e2c",
      "name": "Join IP Analysis into one JSON object",
      "type": "n8n-nodes-base.itemLists",
      "position": [
        1960,
        660
      ],
      "parameters": {
        "options": {},
        "aggregate": "aggregateAllItemData",
        "operation": "concatenateItems",
        "destinationFieldName": "ipAnalysis"
      },
      "typeVersion": 3
    },
    {
      "id": "1e5ae57b-948c-40c8-8248-fcbda80264e2",
      "name": "Join results into one JSON object",
      "type": "n8n-nodes-base.itemLists",
      "position": [
        2391,
        760
      ],
      "parameters": {
        "options": {},
        "aggregate": "aggregateAllItemData",
        "operation": "concatenateItems",
        "destinationFieldName": "result"
      },
      "typeVersion": 3
    },
    {
      "id": "7fef7675-1350-4886-b184-f907dacf08b1",
      "name": "SPF Authentication Checker",
      "type": "n8n-nodes-base.switch",
      "position": [
        500,
        2718
      ],
      "parameters": {
        "rules": {
          "rules": [
            {
              "value2": "spf=pass",
              "operation": "contains"
            },
            {
              "output": 1,
              "value2": "spf=fail",
              "operation": "contains"
            },
            {
              "output": 2,
              "value2": "spf=neutral",
              "operation": "contains"
            }
          ]
        },
        "value1": "={{ JSON.stringify($json.header[\"authentication-results\"]) }}",
        "dataType": "string",
        "fallbackOutput": 3
      },
      "typeVersion": 1
    },
    {
      "id": "410ccb8c-a551-45a3-a487-b0ce15a56882",
      "name": "Set SPF Pass Status",
      "type": "n8n-nodes-base.set",
      "position": [
        920,
        2518
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "spf",
              "value": "pass"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 2
    },
    {
      "id": "127c0c91-162c-4cbb-b692-eb0675a55c42",
      "name": "Set SPF Fail Status",
      "type": "n8n-nodes-base.set",
      "position": [
        920,
        2658
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "spf",
              "value": "fail"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 2
    },
    {
      "id": "7a15ae91-012f-4fc8-9075-7f855b15d979",
      "name": "Set SPF Neutral Status",
      "type": "n8n-nodes-base.set",
      "position": [
        920,
        2798
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "spf",
              "value": "neutral"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 2
    },
    {
      "id": "2ac1e5ce-83a4-4205-9774-76506f06108e",
      "name": "Set SPF UnknownStatus",
      "type": "n8n-nodes-base.set",
      "position": [
        920,
        2938
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "spf",
              "value": "unknown"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 2
    }
  ],
  "active": false,
  "pinData": {
    "Receive Headers": [
      {
        "json": {
          "body": "Delivered-To: g.andreini@gmail.com\nReceived: by 2002:a05:7412:be08:b0:df:2c3c:4cc with SMTP id la8csp2349351rdb;\n        Tue, 5 Sep 2023 15:06:08 -0700 (PDT)\nX-Google-Smtp-Source: AGHT+IEHz2WAE5kssnJSpwJyhbuq3ZjNQTqZfo6OFeCd5w2EKOdnF3nICb1zIL4Y1tahQpr5xY6+\nX-Received: by 2002:a17:907:78c3:b0:9a1:f2d3:ade9 with SMTP id kv3-20020a17090778c300b009a1f2d3ade9mr802685ejc.42.1693951567785;\n        Tue, 05 Sep 2023 15:06:07 -0700 (PDT)\nARC-Seal: i=1; a=rsa-sha256; t=1693951567; cv=none;\n        d=google.com; s=arc-20160816;\n        b=zsD04giTt/gbOxX6IW6/ETi7zkiuLYPaM6nYtckkcCfhqz5H7qvNN1NkDrlbnsXEr2\n         3jVLDlhAZCXVg4qGNEWTjfzLwn5eQoUdW7iy//8XZU3Xy2xtORLBKKWs+Pjzx2sBP9KS\n         zsy0Tg+rlAqi/aOH8+D+ANC0dCibsPau92zLS6GIvil700hvAJ7KB9fw0s/Ntx4z8VGv\n         0P+BodOQDO9kdHtuMkgu/waF86Xe0ImcxtvMHQ/mNjbTSRDTa0d04+X7ILVf4q0B5gFg\n         tnykE51GIS8Ey8ElAd4z/it1E/ffMJ7QAgiDSO0tZRc2NnM0QQ1oYrO9IL0cNuW1P33Q\n         PfNA==\nARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;\n        h=mime-version:date:subject:to:from:reply-to:message-id;\n        bh=f9tT4LpRqlQSioyOCLufJC57T1y2rwgsPezOJPbokDM=;\n        fh=syfPZFOxHm03Bg8T666hpPsY3BFS1EZPTr8jKyQ7bFk=;\n        b=fsZErxdmb95VXJpAyI8Pff38Ifu47WaONvSwpYaSstYbRoKDZSS3SH247NHt/+uyq+\n         7UUF37XenbcZif1p3iOa96JxcYBtLLp3cI9pe8NRQjJtceXQk70PVcCGNXORiAxoCGT+\n         iCMzUoFjTAfhK729rSldyFJ+I+WU3k+W/CjL1+geJkU5fEmg+eBEo8hDifqW3Iv73auq\n         uDnxkLZ55yX9W2ARwv/204qqqxYHKfdXDIWGDyeXE10NHLTr/GAR8DWVx6qD8b4U0Zc3\n         MC+SZxGsIcSCr5ouXIovuQBYcdmqDgDxAaN9VTfYdnXobblN6bo3OcC0rqiiyVJnV3ZA\n         BYoQ==\nARC-Authentication-Results: i=1; mx.google.com;\n       spf=fail (google.com: domain of eljyzxd@molkase.de does not designate 89.31.72.29 as permitted sender) smtp.mailfrom=eljyzxd@molkase.de\nReturn-Path: <eljyzxd@molkase.de>\nReceived: from mail19.interhost.it (mail19.interhost.it. [89.31.72.29])\n        by mx.google.com with ESMTPS id k15-20020a170906578f00b00992aaed9f81si7955121ejq.356.2023.09.05.15.06.07\n        for <g.andreini@gmail.com>\n        (version=TLS1_2 cipher=ECDHE-ECDSA-AES128-GCM-SHA256 bits=128/128);\n        Tue, 05 Sep 2023 15:06:07 -0700 (PDT)\nReceived-SPF: fail (google.com: domain of eljyzxd@molkase.de does not designate 89.31.72.29 as permitted sender) client-ip=89.31.72.29;\nAuthentication-Results: mx.google.com;\n       spf=fail (google.com: domain of eljyzxd@molkase.de does not designate 89.31.72.29 as permitted sender) smtp.mailfrom=eljyzxd@molkase.de\nReceived: from mailfront2.interhost.it (mailfront2.interhost.it [89.31.72.21]) (using TLSv1.2 with cipher ADH-AES256-GCM-SHA384 (256/256 bits)) (No client certificate requested) by mail19.interhost.it (Postfix) with ESMTPS id 7BA73561D21 for <info@thepund.it>; Wed,\n  6 Sep 2023 00:06:06 +0200 (CEST)\nReceived: from mailfront2.interhost.it (localhost [127.0.0.1]) by mailfront2.interhost.it (Postfix) with ESMTP id 5AEE1835B2 for <info@thepund.it>; Wed,\n  6 Sep 2023 00:06:06 +0200 (CEST)\nReceived-SPF: Pass (mailfrom) identity=mailfrom; client-ip=62.173.139.164; helo=mail.molkase.de; envelope-from=eljyzxd@molkase.de; receiver=<UNKNOWN>\nReceived: from mail.molkase.de (mail.molkase.de [62.173.139.164]) by mailfront2.interhost.it (Postfix) with ESMTP id A8BC3835B5 for <info@thepund.it>; Wed,\n  6 Sep 2023 00:06:05 +0200 (CEST)\nReceived: from molkase.de (mail.molkase.de [62.173.139.164]) by mail.molkase.de (Postfix) with ESMTPA id A561D80FB872; Tue,\n  5 Sep 2023 23:08:50 +0300 (EEST)\nMessage-ID: <15404342A12424728J51235153O87748181D@ideljyzxd>\nReply-To: Legal Casino <eljyzxd@molkase.de>\nFrom: Legal Casino <eljyzxd@molkase.de>\nTo: <info@tevassociati.it>\nSubject: Bonus for all European residents\nDate: Tue, 05 Sep 2023 23:08:55 +0300\nMIME-Version: 1.0\nContent-Type: multipart/related; type=\"multipart/alternative\"; boundary=\"----=_NextPart_000_0018_01D9E04D.79971B70\"\nX-Virus-Scanned: ClamAV using ClamSMTP",
          "query": {},
          "params": {},
          "headers": {
            "host": "internal.users.n8n.cloud",
            "accept": "*/*",
            "x-real-ip": "10.255.0.2",
            "user-agent": "PostmanRuntime/7.32.3",
            "content-type": "text/plain",
            "authorization": "1234567890",
            "postman-token": "8701ef86-2136-4c79-941a-bc8ed79bcc9e",
            "content-length": "3900",
            "accept-encoding": "gzip, deflate, br",
            "x-forwarded-for": "10.255.0.2",
            "x-forwarded-host": "internal.users.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "e591fa1c2d01"
          }
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6e01f4f9-d42b-4168-91a1-0bfe850c43ea",
  "connections": {
    "IP-API": {
      "main": [
        [
          {
            "node": "Fraud Score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fraud Score": {
      "main": [
        [
          {
            "node": "Collect interesting data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IP Data Merge": {
      "main": [
        [
          {
            "node": "Join IP Analysis into one JSON object",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out IPs": {
      "main": [
        [
          {
            "node": "IP Quality Score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Receive Headers": {
      "main": [
        [
          {
            "node": "Extract Email Header from webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IP Quality Score": {
      "main": [
        [
          {
            "node": "IP-API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Security Data": {
      "main": [
        [
          {
            "node": "Join results into one JSON object",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set SPF Fail Status": {
      "main": [
        [
          {
            "node": "DKIM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set SPF Pass Status": {
      "main": [
        [
          {
            "node": "DKIM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Explode Email Header": {
      "main": [
        [
          {
            "node": "Received Headers Present?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Authentication Results Present?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set SPF UnknownStatus": {
      "main": [
        [
          {
            "node": "DKIM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set SPF Neutral Status": {
      "main": [
        [
          {
            "node": "DKIM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SPF from \"received-spf\"": {
      "main": [
        [
          {
            "node": "DKIM from \"dkim-signature\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Collect interesting data": {
      "main": [
        [
          {
            "node": "IP Data Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Received Headers Present?": {
      "main": [
        [
          {
            "node": "Extract IPs from \"received\"",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IP Data Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "DKIM from \"dkim-signature\"": {
      "main": [
        [
          {
            "node": "DMARC from \"received-dmarc\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SPF Authentication Checker": {
      "main": [
        [
          {
            "node": "Set SPF Pass Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set SPF Fail Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set SPF Neutral Status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set SPF UnknownStatus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DMARC from \"received-dmarc\"": {
      "main": [
        [
          {
            "node": "Aggregate Authentication Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract IPs from \"received\"": {
      "main": [
        [
          {
            "node": "Split Out IPs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Authentication Data": {
      "main": [
        [
          {
            "node": "Merge Security Data",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Authentication Results Present?": {
      "main": [
        [
          {
            "node": "SPF/DKIM/DMARC from \"authentication-results\"",
            "type": "main",
            "index": 0
          },
          {
            "node": "SPF Authentication Checker",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SPF from \"received-spf\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Email Header from webhook": {
      "main": [
        [
          {
            "node": "Explode Email Header",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Join results into one JSON object": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Join IP Analysis into one JSON object": {
      "main": [
        [
          {
            "node": "Merge Security Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SPF/DKIM/DMARC from \"authentication-results\"": {
      "main": [
        [
          {
            "node": "Merge Security Data",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  }
}