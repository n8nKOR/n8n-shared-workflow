{
  "id": "uD31xU0VYjogxWoY",
  "meta": {
    "instanceId": "03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8"
  },
  "name": "Create_Unique_Jira_tickets_from_Splunk_alerts",
  "tags": [
    {
      "id": "GCHVocImoXoEVnzP",
      "name": "ðŸ› ï¸ In progress",
      "createdAt": "2023-10-31T02:17:21.618Z",
      "updatedAt": "2023-10-31T02:17:21.618Z"
    },
    {
      "id": "QPJKatvLSxxtrE8U",
      "name": "Secops",
      "createdAt": "2023-10-31T02:15:11.396Z",
      "updatedAt": "2023-10-31T02:15:11.396Z"
    }
  ],
  "nodes": [
    {
      "id": "3f9fa220-1966-4478-b7db-c39056564c9d",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -640,
        320
      ],
      "webhookId": "f2a52578-2fef-40a6-a7ff-e03f6b751a02",
      "parameters": {
        "path": "f2a52578-2fef-40a6-a7ff-e03f6b751a02",
        "options": {},
        "httpMethod": "POST"
      },
      "typeVersion": 1
    },
    {
      "id": "375ac47e-7975-45cb-b7c1-cef1c7fca701",
      "name": "Add Ticket Comment",
      "type": "n8n-nodes-base.jira",
      "position": [
        240,
        520
      ],
      "parameters": {
        "comment": "=Timestamp: {{ $('Set Host Name').item.json.body.timestamp }}\nDescription: {{ $('Set Host Name').item.json.body.description }}",
        "options": {},
        "issueKey": "={{ $json.key }}",
        "resource": "issueComment"
      },
      "credentials": {
        "jiraSoftwareCloudApi": {
          "id": "OYvpDV2Q42eY6iyA",
          "name": "Alex Jira Cloud"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "a5dea875-6adf-4d18-aeb9-5fe31a0ebfae",
      "name": "Search Ticket",
      "type": "n8n-nodes-base.jira",
      "position": [
        -200,
        320
      ],
      "parameters": {
        "options": {
          "jql": "=splunkhostname ~ \"{{ $json['splunk-host-name'] }}\" "
        },
        "operation": "getAll"
      },
      "credentials": {
        "jiraSoftwareCloudApi": {
          "id": "OYvpDV2Q42eY6iyA",
          "name": "Alex Jira Cloud"
        }
      },
      "typeVersion": 1,
      "alwaysOutputData": true
    },
    {
      "id": "3dac410e-1e37-463d-9aba-bc6abf3889f7",
      "name": "Set Host Name",
      "type": "n8n-nodes-base.set",
      "position": [
        -420,
        320
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "splunk-host-name",
              "value": "={{ $json.body.inputs.A.key['host.name'].replace(/[^a-zA-Z0-9 ]/g, '') }}"
            }
          ]
        },
        "options": {}
      },
      "typeVersion": 2
    },
    {
      "id": "465ec3b0-dd16-482e-b4b6-f8ed91fbb11b",
      "name": "IF Ticket Not Exists",
      "type": "n8n-nodes-base.if",
      "position": [
        20,
        320
      ],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.key }}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "1315b76b-39fc-4fd3-9a45-a91e5e873874",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1120,
        -26.960531840248223
      ],
      "parameters": {
        "width": 643.8620281403546,
        "height": 537.944771288002,
        "content": "![ë°”ì´ëŸ¬ìŠ¤í† íƒˆ](https://i.imgur.com/spMd6AQ.png)  \n## ì›¹í›… ë…¸ë“œ  \nSplunkì— ëŒ€í•œ ì›¹í›… í†µí•©ì„ ì„¤ì •í•˜ë ¤ë©´, ë¨¼ì € Splunkì´ ì›¹í›…ìœ¼ë¡œ ê²½ê³ ë¥¼ ë³´ë‚´ë„ë¡ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. [ì„¤ì • ê°€ì´ë“œ](https://docs.splunk.com/observability/en/admin/notif-services/webhook.html)ë¥¼ ë°©ë¬¸í•˜ì„¸ìš”. ì•„ëž˜ ì›¹í›… ë…¸ë“œë¥¼ ì—´ì–´ n8n ì›¹í›… URLì„ ë³µì‚¬í•˜ì„¸ìš”.  \n- **í˜•ì‹ ì ‘ê·¼ URL**:  \n  - **ì‹¤í–‰ ëª¨ë“œ**: `https://n8n.domain.com/webhook/test/webhookpath` - n8n ìº”ë²„ìŠ¤ ë‚´ì—ì„œ ì›Œí¬í”Œë¡œë¥¼ ëŒ€í™”í˜•ìœ¼ë¡œ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ì„¸ìš”. 'Execute Workflow' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤ì‹œê°„ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ì„¸ìš”. ì›¹í›… ë…¸ë“œì— ë°ì´í„°ë¥¼ ê³ ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‰½ê²Œ í–ˆìŠµë‹ˆë‹¤.  \n  - **Silent Mode**: `https://n8n.domain.com/webhook/webhookpath` - ìº”ë²„ìŠ¤ ì—…ë°ì´íŠ¸ ì—†ì´ ë°°ê²½ ì‹¤í–‰ì„ ìœ„í•´ ì‚¬ìš©í•˜ì„¸ìš”. ê²°ê³¼ëŠ” silently ë¡œê·¸ë˜ë©° 'Executions' íƒ­ì—ì„œ ê²€í† í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "636425b9-a11f-4891-aa00-2f3c42956c01",
      "name": "Create Ticket",
      "type": "n8n-nodes-base.jira",
      "position": [
        240,
        160
      ],
      "parameters": {
        "project": {
          "__rl": true,
          "mode": "list",
          "value": "10001",
          "cachedResultName": "Service Desk"
        },
        "summary": "=Splunk Alert for host {{ $('Set Host Name').item.json.body.inputs.A.key[\"host.name\"] }}:  {{ $('Set Host Name').item.json.body.description }}",
        "issueType": {
          "__rl": true,
          "mode": "list",
          "value": "10004",
          "cachedResultName": "[System] Incident"
        },
        "additionalFields": {
          "description": "={{ $('Set Host Name').item.json.body.description }}\n\n{{ $('Set Host Name').item.json.body.messageBody }}",
          "customFieldsUi": {
            "customFieldsValues": [
              {
                "fieldId": {
                  "__rl": true,
                  "mode": "id",
                  "value": "customfield_10063"
                },
                "fieldValue": "={{ $('Webhook').item.json[\"body\"][\"inputs\"][\"A\"][\"key\"][\"host.name\"].replace(/[^a-zA-Z0-9 ]/g, '') }}"
              }
            ]
          }
        }
      },
      "credentials": {
        "jiraSoftwareCloudApi": {
          "id": "OYvpDV2Q42eY6iyA",
          "name": "Alex Jira Cloud"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "47af8bdb-e0da-4923-8f0a-05deb86ac1b3",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -460,
        98.72468966845895
      ],
      "parameters": {
        "width": 401.99970102055784,
        "height": 413.43480804607805,
        "content": "![ë°”ì´ëŸ¬ìŠ¤í† íƒˆ](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)  \n## í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì •ê·œí™”  \níŠ¹ìˆ˜ ë¬¸ìžê°€ Jiraë¡œ ì „ë‹¬ë˜ì–´ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•´, ì´ ì„¤ì • ë…¸ë“œëŠ” `splunk-host-name`ì—ì„œ íŠ¹ìˆ˜ ë¬¸ìžë¥¼ ì œê±°í•˜ê³ , ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰í•˜ê³  í‹°ì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì€ ì‚¬ìš©ìž ì •ì˜ í•„ë“œë¡œ ì €ìž¥ë©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "c0bf09e6-ca08-4db6-aff0-a6528a8fb03b",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        180,
        -21.934709587377256
      ],
      "parameters": {
        "width": 401.99970102055784,
        "height": 348.38243930996134,
        "content": "ìƒˆ í‹°ì¼“ ìƒì„±  \nì´ê²ƒì€ ë‹¹ì‹ ì˜ í”„ë¡œì íŠ¸ì™€ ì´ìŠˆ ìœ í˜•ì— ìƒˆ í‹°ì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ ê°’ë“¤ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ ì˜¬ë°”ë¥´ê²Œ ìž‘ë™í•˜ë„ë¡ í•˜ì„¸ìš”."
      },
      "typeVersion": 1
    },
    {
      "id": "a175e343-83ed-4442-94df-7e7027b8c687",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        180,
        340
      ],
      "parameters": {
        "width": 401.99970102055784,
        "height": 341.08777742613927,
        "content": "![ë°”ì´ëŸ¬ìŠ¤í† í„¸](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)  \n## í‹°ì¼“ ëŒ“ê¸€ ì¶”ê°€  \nì´ê²ƒì€ ê¸°ì¡´ í‹°ì¼“ì— ê²½ê³ ë¥¼ ëŒ“ê¸€ë¡œ ì¶”ê°€í•˜ì—¬ ë°ì´í„°ê°€ ì¤‘ë³µë˜ì§€ ì•Šê²Œ í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    },
    {
      "id": "09143b8c-a4ce-4791-8937-3333d24b6e01",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -40,
        100.50445897107033
      ],
      "parameters": {
        "width": 193.6032856277124,
        "height": 415.27445353029793,
        "content": "## í‹°ì¼“ì´ ë°œê²¬ë˜ì—ˆëŠ”ì§€ í™•ì¸  \nì´ê²ƒì€ `$json.key`ë¥¼ í™•ì¸í•˜ì—¬ ê°’ì´ ë°œê²¬ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•˜ê³ , ê·¸ì— ë”°ë¼ ë¼ìš°íŒ…í•©ë‹ˆë‹¤."
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {
    "Webhook": [
      {
        "json": {
          "body": {
            "tip": null,
            "rule": "n8n-test",
            "inputs": {
              "A": {
                "key": {
                  "os.type": "linux",
                  "host.name": "n8n-enterprise-demo",
                  "sf_metric": "cpu.utilization"
                },
                "value": "0.1670342357065173",
                "fragment": "data('cpu.utilization').publish(label='A')"
              },
              "_S2": {
                "value": "0.2",
                "fragment": "threshold(0.2)"
              }
            },
            "status": "ok",
            "detector": "n8n-test",
            "imageUrl": "https://static.eu0.signalfx.com/signed/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjb20uc2lnbmFsZnguYXBwIiwiZXhwIjoxNjk0NjE0NjI2LCJpSWQiOiJGNVZBcTEwQUVBQSIsIm9JZCI6IkY1V0JKZ2lBSUFBIiwiYlQiOiJlbmQifQ.udzyF5-HqKyV_EMRmT51EtgECK9g-wanl8nx_MH0i9Q/async",
            "severity": "Critical",
            "eventType": "F5Vx1EuAAKc__F5V-TcTAEJ8__n8n-test",
            "sf_schema": 2,
            "timestamp": "2023-09-06T14:17:00Z",
            "detectorId": "F5V-TcTAEJ8",
            "incidentId": "F5VAq10AEAA",
            "runbookUrl": null,
            "description": "The value of cpu.utilization is above 0.2.",
            "detectorUrl": "https://app.eu0.signalfx.com/#/detector/F5V-TcTAEJ8/edit?incidentId=F5VAq10AEAA&is=ok",
            "messageBody": "Rule \"n8n-test\" in detector \"n8n-test\" cleared at Wed, 6 Sep 2023 14:17:00 GMT.\n\nCurrent signal value for n8n.test: 0.1670342357065173\n\nSignal details:\n{sf_metric=cpu.utilization, host.name=n8n-enterprise-demo, os.type=linux}",
            "messageTitle": "Back to normal: n8n-test (n8n-test)",
            "statusExtended": "ok",
            "detectOnCondition": "when(A > threshold(0.2))",
            "originatingMetric": "cpu.utilization",
            "triggeredWhileMuted": false
          },
          "query": {},
          "params": {},
          "headers": {
            "host": "internal.users.n8n.cloud",
            "x-real-ip": "10.255.0.2",
            "user-agent": "Apache-HttpClient/4.5.14 (Java/1.8.0_372)",
            "content-type": "application/json; charset=utf-8",
            "content-length": "1366",
            "accept-encoding": "gzip,deflate",
            "x-forwarded-for": "10.255.0.2",
            "x-forwarded-host": "internal.users.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "e591fa1c2d01"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3985cac2-7f23-4d27-b826-0edfb0544b58",
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Set Host Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Ticket": {
      "main": [
        [
          {
            "node": "IF Ticket Not Exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Host Name": {
      "main": [
        [
          {
            "node": "Search Ticket",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Ticket Not Exists": {
      "main": [
        [
          {
            "node": "Create Ticket",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Ticket Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}